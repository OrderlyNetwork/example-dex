import{r as v,j as o,c as U}from"./index-CNjFkONN.js";import{bC as Vs,bs as Bs,bv as qs,bA as Ue,bD as at,bu as $s,bx as jt,bE as Us,bF as qr,aY as Ks,bo as zs,bG as Qs,aZ as Ws,a$ as Hs,a_ as Cr,bH as Ys,bi as Zt,bI as Gs,bJ as Js,bK as er,bL as $r,bM as kt,bN as Ke,bO as Xs,bP as lt,bQ as Zs,bR as te,bS as et,aX as ie,bT as xe,bU as pe,bV as tr,bd as ct,bh as Qe,bf as ei,bW as ti,bj as rr,bk as sr,aW as ze,bl as ir,bm as nr,bX as ri,bY as si,bZ as ii,b_ as ni,b$ as oi,c0 as ai,bn as li}from"./react-icons.esm-BBQYN978.js";import{e as Ce,u as X,a as Ur,c as Kr,d as tt,f as rt,P as yt,T as ue,g as or,m as zr,h as Qr,i as de,b as Wr}from"./TokenInput-rIJ_PRj5.js";import{u as ci,o as Bt,C as ui}from"./ConnectWalletButton-CfjkbYNh.js";function di(e){const t=v.useRef({value:e,previous:e});return v.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var Hr=["PageUp","PageDown"],Yr=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Gr={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},We="Slider",[qt,fi,hi]=Vs(We),[Jr,Ao]=Bs(We,[hi]),[gi,Pt]=Jr(We),Xr=v.forwardRef((e,t)=>{const{name:r,min:s=0,max:i=100,step:n=1,orientation:a="horizontal",disabled:c=!1,minStepsBetweenThumbs:u=0,defaultValue:m=[s],value:f,onValueChange:h=()=>{},onValueCommit:x=()=>{},inverted:_=!1,...P}=e,A=v.useRef(new Set),j=v.useRef(0),O=a==="horizontal"?mi:pi,[E=[],k]=qs({prop:f,defaultProp:m,onChange:C=>{var w;(w=[...A.current][j.current])==null||w.focus(),h(C)}}),D=v.useRef(E);function z(C){const N=xi(E,C);L(C,N)}function V(C){L(C,j.current)}function M(){const C=D.current[j.current];E[j.current]!==C&&x(E)}function L(C,N,{commit:w}={commit:!1}){const F=ji(n),q=ki(Math.round((C-s)/n)*n+s,F),H=qr(q,[s,i]);k((G=[])=>{const Q=_i(G,H,N);if(Ci(Q,u*n)){j.current=Q.indexOf(H);const ye=String(Q)!==String(G);return ye&&w&&x(Q),ye?Q:G}else return G})}return o.jsx(gi,{scope:e.__scopeSlider,name:r,disabled:c,min:s,max:i,valueIndexToChangeRef:j,thumbs:A.current,values:E,orientation:a,children:o.jsx(qt.Provider,{scope:e.__scopeSlider,children:o.jsx(qt.Slot,{scope:e.__scopeSlider,children:o.jsx(O,{"aria-disabled":c,"data-disabled":c?"":void 0,...P,ref:t,onPointerDown:Ue(P.onPointerDown,()=>{c||(D.current=E)}),min:s,max:i,inverted:_,onSlideStart:c?void 0:z,onSlideMove:c?void 0:V,onSlideEnd:c?void 0:M,onHomeKeyDown:()=>!c&&L(s,0,{commit:!0}),onEndKeyDown:()=>!c&&L(i,E.length-1,{commit:!0}),onStepKeyDown:({event:C,direction:N})=>{if(!c){const q=Hr.includes(C.key)||C.shiftKey&&Yr.includes(C.key)?10:1,H=j.current,G=E[H],Q=n*q*N;L(G+Q,H,{commit:!0})}}})})})})});Xr.displayName=We;var[Zr,es]=Jr(We,{startEdge:"left",endEdge:"right",size:"width",direction:1}),mi=v.forwardRef((e,t)=>{const{min:r,max:s,dir:i,inverted:n,onSlideStart:a,onSlideMove:c,onSlideEnd:u,onStepKeyDown:m,...f}=e,[h,x]=v.useState(null),_=at(t,E=>x(E)),P=v.useRef(),A=$s(i),j=A==="ltr",I=j&&!n||!j&&n;function O(E){const k=P.current||h.getBoundingClientRect(),D=[0,k.width],V=ar(D,I?[r,s]:[s,r]);return P.current=k,V(E-k.left)}return o.jsx(Zr,{scope:e.__scopeSlider,startEdge:I?"left":"right",endEdge:I?"right":"left",direction:I?1:-1,size:"width",children:o.jsx(ts,{dir:A,"data-orientation":"horizontal",...f,ref:_,style:{...f.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:E=>{const k=O(E.clientX);a==null||a(k)},onSlideMove:E=>{const k=O(E.clientX);c==null||c(k)},onSlideEnd:()=>{P.current=void 0,u==null||u()},onStepKeyDown:E=>{const D=Gr[I?"from-left":"from-right"].includes(E.key);m==null||m({event:E,direction:D?-1:1})}})})}),pi=v.forwardRef((e,t)=>{const{min:r,max:s,inverted:i,onSlideStart:n,onSlideMove:a,onSlideEnd:c,onStepKeyDown:u,...m}=e,f=v.useRef(null),h=at(t,f),x=v.useRef(),_=!i;function P(A){const j=x.current||f.current.getBoundingClientRect(),I=[0,j.height],E=ar(I,_?[s,r]:[r,s]);return x.current=j,E(A-j.top)}return o.jsx(Zr,{scope:e.__scopeSlider,startEdge:_?"bottom":"top",endEdge:_?"top":"bottom",size:"height",direction:_?1:-1,children:o.jsx(ts,{"data-orientation":"vertical",...m,ref:h,style:{...m.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:A=>{const j=P(A.clientY);n==null||n(j)},onSlideMove:A=>{const j=P(A.clientY);a==null||a(j)},onSlideEnd:()=>{x.current=void 0,c==null||c()},onStepKeyDown:A=>{const I=Gr[_?"from-bottom":"from-top"].includes(A.key);u==null||u({event:A,direction:I?-1:1})}})})}),ts=v.forwardRef((e,t)=>{const{__scopeSlider:r,onSlideStart:s,onSlideMove:i,onSlideEnd:n,onHomeKeyDown:a,onEndKeyDown:c,onStepKeyDown:u,...m}=e,f=Pt(We,r);return o.jsx(jt.span,{...m,ref:t,onKeyDown:Ue(e.onKeyDown,h=>{h.key==="Home"?(a(h),h.preventDefault()):h.key==="End"?(c(h),h.preventDefault()):Hr.concat(Yr).includes(h.key)&&(u(h),h.preventDefault())}),onPointerDown:Ue(e.onPointerDown,h=>{const x=h.target;x.setPointerCapture(h.pointerId),h.preventDefault(),f.thumbs.has(x)?x.focus():s(h)}),onPointerMove:Ue(e.onPointerMove,h=>{h.target.hasPointerCapture(h.pointerId)&&i(h)}),onPointerUp:Ue(e.onPointerUp,h=>{const x=h.target;x.hasPointerCapture(h.pointerId)&&(x.releasePointerCapture(h.pointerId),n(h))})})}),rs="SliderTrack",ss=v.forwardRef((e,t)=>{const{__scopeSlider:r,...s}=e,i=Pt(rs,r);return o.jsx(jt.span,{"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation,...s,ref:t})});ss.displayName=rs;var $t="SliderRange",is=v.forwardRef((e,t)=>{const{__scopeSlider:r,...s}=e,i=Pt($t,r),n=es($t,r),a=v.useRef(null),c=at(t,a),u=i.values.length,m=i.values.map(x=>os(x,i.min,i.max)),f=u>1?Math.min(...m):0,h=100-Math.max(...m);return o.jsx(jt.span,{"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,...s,ref:c,style:{...e.style,[n.startEdge]:f+"%",[n.endEdge]:h+"%"}})});is.displayName=$t;var Ut="SliderThumb",ns=v.forwardRef((e,t)=>{const r=fi(e.__scopeSlider),[s,i]=v.useState(null),n=at(t,c=>i(c)),a=v.useMemo(()=>s?r().findIndex(c=>c.ref.current===s):-1,[r,s]);return o.jsx(yi,{...e,ref:n,index:a})}),yi=v.forwardRef((e,t)=>{const{__scopeSlider:r,index:s,name:i,...n}=e,a=Pt(Ut,r),c=es(Ut,r),[u,m]=v.useState(null),f=at(t,O=>m(O)),h=u?!!u.closest("form"):!0,x=Us(u),_=a.values[s],P=_===void 0?0:os(_,a.min,a.max),A=vi(s,a.values.length),j=x==null?void 0:x[c.size],I=j?Si(j,P,c.direction):0;return v.useEffect(()=>{if(u)return a.thumbs.add(u),()=>{a.thumbs.delete(u)}},[u,a.thumbs]),o.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[c.startEdge]:`calc(${P}% + ${I}px)`},children:[o.jsx(qt.ItemSlot,{scope:e.__scopeSlider,children:o.jsx(jt.span,{role:"slider","aria-label":e["aria-label"]||A,"aria-valuemin":a.min,"aria-valuenow":_,"aria-valuemax":a.max,"aria-orientation":a.orientation,"data-orientation":a.orientation,"data-disabled":a.disabled?"":void 0,tabIndex:a.disabled?void 0:0,...n,ref:f,style:_===void 0?{display:"none"}:e.style,onFocus:Ue(e.onFocus,()=>{a.valueIndexToChangeRef.current=s})})}),h&&o.jsx(bi,{name:i??(a.name?a.name+(a.values.length>1?"[]":""):void 0),value:_},s)]})});ns.displayName=Ut;var bi=e=>{const{value:t,...r}=e,s=v.useRef(null),i=di(t);return v.useEffect(()=>{const n=s.current,a=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(a,"value").set;if(i!==t&&u){const m=new Event("input",{bubbles:!0});u.call(n,t),n.dispatchEvent(m)}},[i,t]),o.jsx("input",{style:{display:"none"},...r,ref:s,defaultValue:t})};function _i(e=[],t,r){const s=[...e];return s[r]=t,s.sort((i,n)=>i-n)}function os(e,t,r){const n=100/(r-t)*(e-t);return qr(n,[0,100])}function vi(e,t){return t>2?`Value ${e+1} of ${t}`:t===2?["Minimum","Maximum"][e]:void 0}function xi(e,t){if(e.length===1)return 0;const r=e.map(i=>Math.abs(i-t)),s=Math.min(...r);return r.indexOf(s)}function Si(e,t,r){const s=e/2,n=ar([0,50],[0,s]);return(s-n(t)*r)*r}function wi(e){return e.slice(0,-1).map((t,r)=>e[r+1]-t)}function Ci(e,t){if(t>0){const r=wi(e);return Math.min(...r)>=t}return!0}function ar(e,t){return r=>{if(e[0]===e[1]||t[0]===t[1])return t[0];const s=(t[1]-t[0])/(e[1]-e[0]);return t[0]+s*(r-e[0])}}function ji(e){return(String(e).split(".")[1]||"").length}function ki(e,t){const r=Math.pow(10,t);return Math.round(e*r)/r}var Pi=Xr,Ti=ss,Oi=is,Ei=ns;const Li=["1","2","3"],Ni=["classic","surface","soft"],Ai={size:{type:"enum",className:"rt-r-size",values:Li,default:"2",responsive:!0},variant:{type:"enum",className:"rt-variant",values:Ni,default:"surface"},...Ks,...zs,...Qs},Tt=v.forwardRef((e,t)=>{const{className:r,color:s,radius:i,tabIndex:n,...a}=Ws(e,Ai,Hs);return v.createElement(Pi,{"data-accent-color":s,"data-radius":i,ref:t,...a,asChild:!1,className:Cr("rt-SliderRoot",r)},v.createElement(Ti,{className:"rt-SliderTrack"},v.createElement(Oi,{className:Cr("rt-SliderRange",{"rt-high-contrast":e.highContrast}),"data-inverted":a.inverted?"":void 0})),(a.value??a.defaultValue??[]).map((c,u)=>v.createElement(Ei,{key:u,className:"rt-SliderThumb",...n!==void 0?{tabIndex:n}:void 0})))});Tt.displayName="Slider";typeof window<"u"&&(window.__ORDERLY_VERSION__=window.__ORDERLY_VERSION__||{},window.__ORDERLY_VERSION__["@orderly.network/trading-view"]="2.0.0");var Kt="Orderly",Le=e=>e.includes(":")?e.split(":")[1]:e,as=e=>e.startsWith(`${Kt}:`)?e:`${Kt}:${e}`;function bt(e){return e===void 0?"":typeof e=="string"?e:e.message}var Di=class{constructor(e,t,r){this._datafeedUrl=e,this._requester=t,this._limitedServerResponse=r}getBars(e,t,r){const s={symbol:e.ticker||"",resolution:t,from:r.from,to:r.to};return r.countBack!==void 0&&(s.countback=r.countBack),e.currency_code!==void 0&&(s.currencyCode=e.currency_code),e.unit_id!==void 0&&(s.unitId=e.unit_id),new Promise(async(i,n)=>{try{const a=await this._requester.sendRequest(this._datafeedUrl,"history",s),c=this._processHistoryResponse(a);this._limitedServerResponse&&await this._processTruncatedResponse(c,s),i(c)}catch(a){if(a instanceof Error||typeof a=="string"){const c=bt(a);console.warn(`HistoryProvider: getBars() failed, error=${c}`),n(c)}}})}async _processTruncatedResponse(e,t){let r=e.bars.length;try{for(;this._limitedServerResponse&&this._limitedServerResponse.maxResponseLength>0&&this._limitedServerResponse.maxResponseLength===r&&t.from<t.to;){t.countback&&(t.countback=t.countback-r),this._limitedServerResponse.expectedOrder==="earliestFirst"?t.from=Math.round(e.bars[e.bars.length-1].time/1e3):t.to=Math.round(e.bars[0].time/1e3);const s=await this._requester.sendRequest(this._datafeedUrl,"history",t),i=this._processHistoryResponse(s);r=i.bars.length,this._limitedServerResponse.expectedOrder==="earliestFirst"?(i.bars[0].time===e.bars[e.bars.length-1].time&&i.bars.shift(),e.bars.push(...i.bars)):(i.bars[i.bars.length-1].time===e.bars[0].time&&i.bars.pop(),e.bars.unshift(...i.bars))}}catch(s){if(s instanceof Error||typeof s=="string"){const i=bt(s);console.warn(`HistoryProvider: getBars() warning during followup request, error=${i}`)}}}_processHistoryResponse(e){if(e.s!=="ok"&&e.s!=="no_data")throw new Error(e.errmsg);const t=[],r={noData:!1};if(e.s==="no_data")r.noData=!0,r.nextTime=e.nextTime;else{const s=e.v!==void 0,i=e.o!==void 0;for(let n=0;n<e.t.length;++n){const a={time:e.t[n]*1e3,close:parseFloat(e.c[n]),open:parseFloat(e.c[n]),high:parseFloat(e.c[n]),low:parseFloat(e.c[n])};i&&(a.open=parseFloat(e.o[n]),a.high=parseFloat(e.h[n]),a.low=parseFloat(e.l[n])),s&&(a.volume=parseFloat(e.v[n])),t.push(a)}}return{bars:t,meta:r}}},Mi=class{constructor(e){e&&(this._headers=e)}sendRequest(e,t,r){if(r!==void 0){const i=Object.keys(r);i.length!==0&&(t+="?"),t+=i.map(n=>`${encodeURIComponent(n)}=${encodeURIComponent(r[n].toString())}`).join("&")}const s={credentials:"same-origin"};return this._headers!==void 0&&(s.headers=this._headers),fetch(`${e}/${t}`,s).then(i=>i.text()).then(i=>JSON.parse(i))}};function $(e,t,r,s){const i=e[t];return Array.isArray(i)&&(!s||Array.isArray(i[0]))?i[r]:i}function ht(e,t,r){return e+(t!==void 0?"_%|#|%_"+t:"")+(r!==void 0?"_%|#|%_"+r:"")}var Fi=class{constructor(e,t,r){this._exchangesList=["Orderly"],this._symbolsInfo={},this._symbolsList=[],this._datafeedUrl=e,this._datafeedSupportedResolutions=t,this._requester=r,this._readyPromise=this._init(),this._readyPromise.catch(s=>{console.error(`SymbolsStorage: Cannot init, error=${s.toString()}`)})}resolveSymbol(e,t,r){return this._readyPromise.then(()=>{const s=this._symbolsInfo[ht(e,t,r)];return s===void 0?Promise.reject("invalid symbol"):Promise.resolve(s)})}searchSymbols(e,t,r,s){return this._readyPromise.then(()=>{const i=[],n=e.length===0;e=e.toUpperCase();for(const c of this._symbolsList){const u=this._symbolsInfo[c];if(u===void 0||r.length>0&&u.type!==r||t&&t.length>0&&u.exchange!==t)continue;const m=u.name.toUpperCase().indexOf(e),f=u.description.toUpperCase().indexOf(e);if((n||m>=0||f>=0)&&!i.some(x=>x.symbolInfo===u)){const x=m>=0?m:8e3+f;i.push({symbolInfo:u,weight:x})}}const a=i.sort((c,u)=>c.weight-u.weight).slice(0,s).map(c=>{const u=c.symbolInfo;return{symbol:u.name,full_name:`${u.exchange}:${u.name}`,description:u.description,exchange:u.exchange,params:[],type:u.type,ticker:u.name}});return Promise.resolve(a)})}_init(){const e=[],t={};for(const r of this._exchangesList)t[r]||(t[r]=!0,e.push(this._requestExchangeData(r)));return Promise.all(e).then(()=>{this._symbolsList.sort()})}_requestExchangeData(e){return new Promise((t,r)=>{this._requester.sendRequest(this._datafeedUrl,"symbol_info",{group:e}).then(s=>{try{this._onExchangeDataReceived(e,s)}catch(i){r(i instanceof Error?i:new Error(`SymbolsStorage: Unexpected exception ${i}`));return}t()}).catch(s=>{`${e}${bt(s)}`,t()})})}_onExchangeDataReceived(e,t){let r=0;try{const s=t.symbol.length,i=t.ticker!==void 0;for(;r<s;++r){const n=t.symbol[r],a=$(t,"exchange-listed",r),c=$(t,"exchange-traded",r),u=c+":"+n,m=$(t,"currency-code",r),f=$(t,"unit-id",r),h=i?$(t,"ticker",r):n,x={ticker:h,name:n,base_name:[a+":"+n],listed_exchange:a,exchange:c,currency_code:m,original_currency_code:$(t,"original-currency-code",r),unit_id:f,original_unit_id:$(t,"original-unit-id",r),unit_conversion_types:$(t,"unit-conversion-types",r,!0),description:$(t,"description",r),has_intraday:qe($(t,"has-intraday",r),!1),visible_plots_set:qe($(t,"visible-plots-set",r),"ohlcv"),minmov:$(t,"minmovement",r)||$(t,"minmov",r)||0,minmove2:$(t,"minmove2",r)||$(t,"minmov2",r),fractional:$(t,"fractional",r),pricescale:$(t,"pricescale",r),type:$(t,"type",r),session:$(t,"session-regular",r),session_holidays:$(t,"session-holidays",r),corrections:$(t,"corrections",r),timezone:$(t,"timezone",r),supported_resolutions:qe($(t,"supported-resolutions",r,!0),this._datafeedSupportedResolutions),has_daily:qe($(t,"has-daily",r),!0),intraday_multipliers:qe($(t,"intraday-multipliers",r,!0),["1","5","15","30","60"]),has_weekly_and_monthly:$(t,"has-weekly-and-monthly",r),has_empty_bars:$(t,"has-empty-bars",r),volume_precision:qe($(t,"volume-precision",r),0),format:"price"};this._symbolsInfo[h]=x,this._symbolsInfo[n]=x,this._symbolsInfo[u]=x,(m!==void 0||f!==void 0)&&(this._symbolsInfo[ht(h,m,f)]=x,this._symbolsInfo[ht(n,m,f)]=x,this._symbolsInfo[ht(u,m,f)]=x),this._symbolsList.push(n)}}catch(s){throw new Error(`SymbolsStorage: API error when processing exchange ${e} symbol #${r} (${t.symbol[r]}): ${Object(s).message}`)}}};function qe(e,t){return e!==void 0?e:t}var Ri=class{constructor(e){this._configuration=jr(),this._symbolsStorage=null,this._datafeedURL=e,this._requester=new Mi,this._historyProvider=new Di(e,this._requester),this._configurationReadyPromise=this._requestConfiguration().then(t=>{t===null&&(t=jr()),this._setupWithConfiguration(t)})}getBars(e,t,r,s,i){this._historyProvider.getBars(e,t,r).then(n=>{s(n.bars,n.meta)}).catch(i)}onReady(e){this._configurationReadyPromise.then(()=>{e(this._configuration)})}searchSymbols(e,t,r,s){if(this._symbolsStorage===null)throw new Error("Datafeed: inconsistent configuration (symbols storage)");this._symbolsStorage.searchSymbols(e,t,r,30).then(s).catch(s.bind(null,[]))}resolveSymbol(e,t,r,s){const i=s&&s.currencyCode,n=s&&s.unitId;function a(c){t(c)}if(this._symbolsStorage===null)throw new Error("Datafeed: inconsistent configuration (symbols storage)");this._symbolsStorage.resolveSymbol(e,i,n).then(a).catch(r)}getMarks(){}getTimescaleMarks(){}getServerTime(){}_requestConfiguration(){return this._send("config").catch(e=>(`${bt(e)}`,null))}_send(e,t){return this._requester.sendRequest(this._datafeedURL,e,t)}_setupWithConfiguration(e){if(this._configuration=e,e.exchanges===void 0&&(e.exchanges=[]),!e.supports_search&&!e.supports_group_request)throw new Error("Unsupported datafeed configuration. Must either support search, or support group request");(e.supports_group_request||!e.supports_search)&&(this._symbolsStorage=new Fi(this._datafeedURL,e.supported_resolutions||[],this._requester)),`${JSON.stringify(e)}`}};function jr(){return{supports_search:!1,supports_group_request:!0,supported_resolutions:["1","3","5","15","30","60","120","240","480","720","1D","3D","1W","1M"],supports_marks:!1,supports_timescale_marks:!1}}var Ii=class{constructor(){this.subscribers=new Map}subscribe(e,t){return this.subscribers.has(e)||this.subscribers.set(e,[]),this.subscribers.get(e).push(t),()=>{this.unsubscribe(e,t)}}unsubscribe(e,t){if(this.subscribers.has(e)){const r=this.subscribers.get(e);this.subscribers.set(e,r.filter(s=>s!==t)),this.subscribers.get(e).length===0&&this.subscribers.delete(e)}}publish(e,t){this.subscribers.has(e)&&this.subscribers.get(e).forEach(s=>{s(t)})}},kr=e=>{let t="1d";switch(e){case"1":t="1m";break;case"3":t="3m";break;case"5":t="5m";break;case"15":t="15m";break;case"30":t="30m";break;case"60":t="1h";break;case"120":t="2h";break;case"240":t="4h";break;case"480":t="8h";break;case"720":t="12h";break;case"D":case"1D":t="1d";break;case"3D":t="3d";break;case"1W":t="1w";break;case"1M":t="1M ";break}return t},Mt=(e,t)=>`${e}kline_${t}`,Vi=e=>["trade"].map(r=>`${e}@${r}`),lr=class Xe{constructor(t){return this.klineSubscribeIdMap=new Map,this.klineOnTickCallback=new Map,this.subscribeCachedTopics=new Map,this.wsInstance=null,this.klineData=new Map,Xe._created||(this.wsInstance=t,Xe._instance=this,Xe._created=!0),Xe._instance}subscribeKline(t,r,s,i){var c;const n=kr(s);this.klineSubscribeIdMap.set(t,{symbol:r,resolution:s});const a=Mt(r,n);if(this.klineOnTickCallback.has(a)){const u=this.klineOnTickCallback.get(a);u[t]=i}else{this.klineOnTickCallback.set(a,{[t]:i});const u=(c=this.wsInstance)==null?void 0:c.subscribe({event:"subscribe",topic:`${r}@kline_${n}`,id:`${r}@kline_${n}`,ts:new Date().getTime()},{onMessage:m=>{const{open:f,close:h,high:x,low:_,volume:P,startTime:A}=m,j=Mt(m.symbol,m.type);this.updateKline(j,{time:A,close:h,open:f,high:x,low:_,volume:P})}});this.subscribeCachedTopics.set(`${r}@kline_${n}`,u)}}unsubscribeKline(t){if(!this.klineSubscribeIdMap.has(t))return;const{symbol:r,resolution:s}=this.klineSubscribeIdMap.get(t),i=kr(s),n=Mt(r,i);if(this.klineOnTickCallback.has(n)){const a=this.klineOnTickCallback.get(n);delete a[t],Object.keys(a).length===0&&(this.klineOnTickCallback.delete(n),this.subscribeCachedTopics.get(`${r}@kline_${i}`)())}delete this.klineSubscribeIdMap[t]}subscribeSymbol(t){Vi(t).forEach(s=>{var i;if(!this.subscribeCachedTopics.has(s)){const n=(i=this.wsInstance)==null?void 0:i.subscribe({event:"subscribe",topic:s,id:s,ts:new Date().getTime()},{onMessage:a=>{this.updateKlineByLastPrice(a.symbol,a.price)}});this.subscribeCachedTopics.set(s,n)}})}updateKlineByLastPrice(t,r){this.klineOnTickCallback.forEach((s,i)=>{if(i.startsWith(t)){const n=this.klineData.get(i);n&&this.updateKline(i,{...n,close:r})}})}updateKline(t,r){const s=this.klineOnTickCallback.get(t);s&&r&&(this.klineData.set(t,r),Object.keys(s).forEach(i=>{const n=s[i];n&&typeof n=="function"&&n(r)}))}};lr._created=!1;lr._instance=null;var ls=lr,Bi=(()=>{let e=0;return()=>e++})(),qi=class extends Ri{constructor(e,t){const r=`${e}/tv`;super(r),this.bbosMap=new Map,this.tickersMap=new Map,this.eventBus=new Ii,this._subscribeQuoteMap=new Map,this._prefixId=Bi(),this._publicWs=new ls(t),this.bbosMap=new Map,t.on("tickers",s=>{for(const i of s.data)i.change=i.close-i.open,i.perChange=i.open?+(100*i.change/i.open).toFixed(2):0,this.tickersMap.set(i.symbol,i);this.eventBus.publish("tickerUpdate",{message:"ticker"})}),t.subscribe({event:"subscribe",topic:"bbos"},{formatter:s=>s,onMessage:s=>{for(const i of s.data)this.bbosMap.set(i.symbol,{ask:i.ask,bid:i.bid,askSize:i.askSize,bidSize:i.bidSize});this.eventBus.publish("tickerUpdate",{message:"bbos"})}})}remove(){Array.from(this._subscribeQuoteMap.values()).forEach(e=>e==null?void 0:e())}getSubscriptionId(e){return`${this._prefixId}${e}`}subscribeBars(e,t,r,s){this._publicWs.subscribeKline(`${this._prefixId}${s}`,e.ticker,t,r)}unsubscribeBars(e){this._publicWs.unsubscribeKline(`${this._prefixId}${e}`)}getQuotes(e,t){const r=this.getSubscriptionId("getQuotes");this.unsubscribeQuotes("getQuotes");const s=this.eventBus.subscribe("tickerUpdate",i=>{const n=new Map;e.forEach(a=>{const c=this.bbosMap.get(Le(a)),u=this.tickersMap.get(Le(a));if(!c||!u)return;const m={...u,ask:c.ask,bid:c.bid};n.set(Le(a),m)}),n.size&&t(Array.from(n.values()).map(a=>this._toUDFTicker(a)))});this._subscribeQuoteMap.set(r,s)}subscribeQuotes(e,t,r,s){const i=`${this._prefixId}${s}`;if(e.length>0){this.unsubscribeQuotes(i);const n=this.eventBus.subscribe("tickerUpdate",a=>{const c=new Map;e.forEach(u=>{const m=this.bbosMap.get(Le(u)),f=this.tickersMap.get(Le(u));if(!m||!f)return;const h={...f,ask:m.ask,bid:m.bid};c.set(Le(u),h)}),c.size&&r(Array.from(c.values()).map(u=>this._toUDFTicker(u)))});this._subscribeQuoteMap.set(i,n)}}unsubscribeQuotes(e){const t=this.getSubscriptionId(e),r=this._subscribeQuoteMap.get(t);r&&(r(),this._subscribeQuoteMap.delete(t))}_toUDFTicker(e){return{n:as(e.symbol),s:"ok",v:{ask:e.ask,bid:e.bid,ch:e.change,chp:e.perChange/100,description:"",exchange:Kt,hight_price:e.high,low_price:e.low,lp:e.close,open_price:e.open,prev_close_price:0,volume:e.volume}}}},$i=(e,t)=>new Promise(r=>{const s=e.querySelector(t);s&&r(s);const i=new MutationObserver(()=>{const n=e.querySelector(t);n&&(r(n),i.disconnect())});i.observe(e,{childList:!0,subtree:!0})}),Ui=class{constructor({iframeDocument:e}){this.iframeDocument=e}defaultHack(){this.showFavoriteStarByDefault()}showFavoriteStarByDefault(){$i(this.iframeDocument,".dropdown-2R6OKuTS").then(()=>{this.iframeDocument.querySelectorAll(".toolbox-2IihgTnv.showOnHover-2IihgTnv").forEach(t=>{t.style.opacity="1"})})}},Ki=e=>{let t=["header_symbol_search","volume_force_overlay","trading_account_manager","drawing_templates","open_account_manager","right_toolbar","support_multicharts","header_layouttoggle","order_panel","order_info","trading_notifications","display_market_status","broker_button","add_to_watchlist","chart_crosshair_menu","header_fullscreen_button","header_widget"];return e===3&&(t=[...t,"left_toolbar","timeframes_toolbar","go_to_date","timezone_menu","create_volume_indicator_by_default","buy_sell_buttons"]),e===0?t=[...t,"header_widget","left_toolbar","timeframes_toolbar","buy_sell_buttons"]:e===1&&(t=[...t,"left_toolbar","timeframes_toolbar","buy_sell_buttons"]),t};function zi(e,t){return{...e,disabled_features:Ki(t),enabled_features:["hide_left_toolbar_by_default","order_panel_close_button"],auto_save_delay:.1,broker_config:{configFlags:{supportStopLimitOrders:!0,supportReversePosition:!1}}}}var cr=e=>`${e}_adapter`,zt={"trading.chart.proterty":JSON.stringify({showSellBuyButtons:0,noConfirmEnabled:1,qweqrq:0,showPricesWithZeroVolume:1,showSpread:1,orderExecutedSoundParams:'{"enabled":0,"name":"alert/alarm_clock"}'}),"hint.startFocusedZoom":"true"},Ae=new Map,Qi=(e,t,r)=>{const s=cr(e);try{const i=t,n=i?JSON.parse(i):void 0,a=r?JSON.parse(r):zt;return i&&Ae.set(e,i),r&&Ae.set(s,r),{savedData:n,adapterSetting:a}}catch(i){console.error(i)}return{savedData:void 0,adapterSetting:zt}},Wi=async(e,t)=>{const r=cr(e),s=localStorage.getItem(e)||"",i=localStorage.getItem(r)||"";try{if(Ae.has(e)&&Ae.has(r))return{savedData:JSON.parse(Ae.get(e)),adapterSetting:JSON.parse(Ae.get(r))}}catch(n){console.error(n)}return Qi(e,s,i)},Hi=async(e,t,r)=>{t&&(localStorage.setItem(e,t),Ae.set(e,t))},Yi=async(e,t,r)=>{const s=cr(e);t&&(localStorage.setItem(s,t),Ae.set(s,t))},Pr=(e,t)=>{let r=null;const s=(...i)=>{r&&window.clearTimeout(r),r=setTimeout(()=>{e(...i)},t)};return s.cancel=()=>{r&&window.clearTimeout(r),r=null},s},Gi="chartProp_default",Tr=300,Ji=class{constructor(e){this._instance=null,this._onClick=null,this._datafeed=null,this._chartKey=Gi,this._adapterSetting=zt,this._savedData=null,this._isLoggedIn=!1,this.debounceSaveChart=Pr(()=>{var t;try{(t=this._instance)==null||t.save(r=>{Object.is(this._savedData,r)||(this._savedData=r,Hi(this._chartKey,JSON.stringify(r),this._isLoggedIn))})}catch(r){console.log("e",r)}},Tr*2),this.debounceSaveChartAdapterSetting=Pr(()=>{Yi(this._chartKey,JSON.stringify(this._adapterSetting),this._isLoggedIn)},Tr),this._create(e)}remove(){var e,t,r;this.unsubscribeClick(),(e=this._datafeed)==null||e.remove(),(t=this._broker)==null||t.remove(),(r=this._instance)==null||r.remove(),this.debounceSaveChart.cancel(),this.debounceSaveChartAdapterSetting.cancel()}updateOverrides(e){this.instance&&this.instance.applyOverrides(e)}setSymbol(e,t,r){var s;try{(s=this._instance)==null||s.onChartReady(()=>{var n,a,c;let i=t??((a=(n=this._instance)==null?void 0:n.symbolInterval())==null?void 0:a.interval);i||(i=1),console.log("current interval",i,e),(c=this._instance)==null||c.setSymbol(e,i,r)})}catch(i){console.log("set symbol error",i)}}executeActionById(e){var t;try{(t=this._instance)==null||t.onChartReady(()=>{var r;(r=this._instance)==null||r.activeChart().executeActionById(e)})}catch(r){console.log("executeActionId error",r)}}changeLineType(e){var t;try{(t=this._instance)==null||t.onChartReady(()=>{var r;(r=this._instance)==null||r.activeChart().setChartType(e)})}catch(r){console.log("executeActionId error",r)}}subscribeClick(e){var t;this._onClick=e,(t=this._instance)==null||t.onChartReady(()=>{var r,s;(s=(r=this._instance)==null?void 0:r._iFrame.contentDocument)==null||s.addEventListener("click",this._onClick)})}unsubscribeClick(){var e,t;(t=(e=this._instance)==null?void 0:e._iFrame.contentDocument)==null||t.removeEventListener("click",this._onClick)}get instance(){return this._instance}chartHack(){var e;(e=this._instance)==null||e.onChartReady(()=>{const t=this._instance._iFrame.contentWindow.document;new Ui({iframeDocument:t}).defaultHack()})}subscribeAutoSave(){var e;(e=this._instance)==null||e.onChartReady(()=>{var t,r;(t=this._instance)==null||t.subscribe("onAutoSaveNeeded",()=>{this.debounceSaveChart()}),(r=this._instance)==null||r.activeChart().onVisibleRangeChanged().subscribe(null,()=>{this.debounceSaveChart()})})}async _create({options:e,chartKey:t,mode:r,onClick:s}){const i=e.getBroker,n={fullscreen:e.fullscreen??!0,autosize:e.autosize??!1,timezone:e.timezone,symbol:e.symbol,library_path:e.libraryPath,interval:e.interval??"1",custom_css_url:e.customCssUrl,custom_font_family:e.customFontFamily,datafeed:e.datafeed,studies_overrides:e.studiesOverrides,locale:e.locale,theme:e.theme,overrides:e.overrides,container:e.container,favorites:{intervals:["1","3","5","15","30","60","240","1D","1W","1M"],chartTypes:["Area","Line"]},broker_factory:i?u=>(this._broker&&this._broker.remove(),this._broker=i(this._instance,u),this._broker):void 0};this._datafeed=e.datafeed,t&&(this._chartKey=t);const{savedData:a,adapterSetting:c}=await Wi(this._chartKey,this._isLoggedIn);this._adapterSetting=c,this._savedData=a,this._instance=new TradingView.widget({...zi(n,r),interval:c["chart.lastUsedTimeBasedResolution"]??n.interval,saved_data:a,settings_adapter:{initialSettings:c,setValue:(u,m)=>{this._adapterSetting={...this._adapterSetting,[u]:m},this.debounceSaveChartAdapterSetting()},removeValue:()=>{}}}),this._instance.onChartReady(()=>{var u;e.symbol&&((u=this._instance)==null?void 0:u.activeChart().symbol())!==Le(e.symbol)&&this.setSymbol(e.symbol)}),this.subscribeAutoSave(),this.subscribeClick(s),this.chartHack()}};function Xi(e,t){let r;return()=>{r&&window.clearTimeout(r),r=window.setTimeout(()=>{r=null,e(arguments)},t)}}function Zi(e,t=[],r=300){const s=v.useRef(),i=v.useRef(),n=v.useCallback(e,t);i.current=n;const a=v.useCallback(Xi(()=>{var c;s.current=(c=i.current)==null?void 0:c.call(i)},r),[]);v.useEffect(a,t),v.useEffect(()=>()=>{s.current instanceof Function&&s.current()},[])}var en=2,tn="--",rn=["BRACKET","STOP_BRACKET"],cs=["POSITIONAL_TP_SL","TP_SL"],us=e=>e.root_algo_order_id!==e.algo_order_id&&(e.algo_type==="TAKE_PROFIT"||e.algo_type==="STOP_LOSS"),sn=e=>!!e&&rn.includes(e),ds=e=>e.type==="CLOSE_POSITION",nn=e=>ds(e)&&e.is_activated,on=e=>us(e)&&e.is_activated,fs=e=>e.root_algo_order_algo_type==="TP_SL"||sn(e.root_algo_order_algo_type)&&e.is_activated,an=(e,t)=>{const r=e.algo_type,s={TAKE_PROFIT:"Take profit",STOP_LOSS:"Stop loss"}[r];return s||null},ln=e=>{const t=new Map;let r=1;return[...e].reverse().filter(fs).forEach(s=>{s.root_algo_order_id&&!t.has(s.root_algo_order_id)&&t.set(s.root_algo_order_id,r++)}),t},cn=(e,t)=>{const r=Math.abs(e.type==="CLOSE_POSITION"?t.balance:e.quantity),s=e.side==="SELL"?1:-1,i=t.open.toString();return{estPnl:new te(e.trigger_price).minus(i??0).times(r).times(s).toString(),quantity:r,openPrice:i}},un=e=>e!==void 0&&e!==""?new te(e).todp(en,te.ROUND_FLOOR):tn;function dn(){const[e,{cancelOrder:t,cancelAlgoOrder:r,cancelTPSLChildOrder:s}]=kt({status:Ke.INCOMPLETE});return v.useCallback(i=>{if(i.algo_order_id){if(cs.includes(i.root_algo_order_algo_type)){const n=e==null?void 0:e.find(c=>c.algo_order_id===i.root_algo_order_id);return n.child_orders.every(c=>!!c.trigger_price)?s(i.algo_order_id,i.root_algo_order_id):r(n.algo_order_id,i.symbol).then()}return r(i.algo_order_id,i.symbol).then()}t(i.order_id,i.symbol).then()},[t,e])}function fn(e){Zs();const[,{updateOrder:t,cancelAlgoOrder:r,updateAlgoOrder:s,updateTPSLOrder:i}]=kt({status:Ke.INCOMPLETE});return v.useCallback((n,a)=>{var u;if(n.algo_order_id)if(cs.includes(n.root_algo_order_algo_type)){const m=[{order_id:n.algo_order_id,trigger_price:new te(a.value).toString()}];return i(n.root_algo_order_id,m).then(f=>{}).catch(f=>{e&&e.error(f.message)})}else{const m={quantity:n.quantity,trigger_price:n.trigger_price,symbol:n.symbol,price:n.price,algo_order_id:n.algo_order_id};return n.order_tag&&(m.order_tag=n.order_tag),a.type==="price"&&(m.price=new te(a.value).toString()),a.type==="trigger_price"&&(m.trigger_price=new te(a.value).toString()),s(n.algo_order_id,m).then(f=>{}).catch(f=>{e&&e.error(f.message)})}const c={order_price:(u=n.price)==null?void 0:u.toString(),order_quantity:n.quantity.toString(),symbol:n.symbol,order_type:n.type,side:n.side,visible_quantity:0,reduce_only:n.reduce_only};return new te(n.visible_quantity??n.visible??0).eq(n.quantity)&&delete c.visible_quantity,Object.keys(n).includes("reduce_only")||delete c.reduce_only,n.order_tag&&(c.order_tag=n.order_tag),a.type==="price"&&(c.order_price=new te(a.value).toString()),t(n.order_id,c).then(m=>{}).catch(m=>{e.error(m.message)})},[t])}function hn(){return{sendLimitOrder:()=>{}}}var gn=({closeConfirm:e,colorConfig:t,onToast:r,mode:s})=>{const i=dn(),n=fn(r),a=lt(),c=v.useCallback(h=>e&&e(h),[e]),{sendLimitOrder:u}=hn(),m=v.useCallback(h=>{if(a)return{baseMin:a[h]("base_min"),baseMax:a[h]("base_max"),baseTick:a[h]("base_tick"),quoteTick:a[h]("quote_tick")}},[a]),f=v.useRef({cancelOrder:i,closePosition:c,editOrder:n,colorConfig:t,sendLimitOrder:u,getSymbolInfo:m,mode:s});return v.useEffect(()=>{f.current.getSymbolInfo=m},[a]),v.useEffect(()=>{f.current.sendLimitOrder=u},[u]),v.useEffect(()=>{f.current.closePosition=c},[e]),v.useEffect(()=>{f.current.cancelOrder=i},[i]),f.current},mn=gn,pn=class Qt{constructor(t,r){this.instance=t,this.currentSymbol="",this.broker=r,this.positionLines={},this.lastPositions=null}renderPositions(t){var r;if(t===null||t.length===0){this.removePositions();return}((r=this.lastPositions)==null?void 0:r.length)!==t.length&&this.removePositions(),t[0].symbol!==this.currentSymbol&&(this.removePositions(),this.currentSymbol=t[0].symbol),t.forEach((s,i)=>this.drawPositionLine(s,i)),this.lastPositions=t}getBasePositionLine(){return this.instance.activeChart().createPositionLine().setTooltip("Close Position").setQuantityBackgroundColor(this.broker.colorConfig.chartBG).setCloseButtonBackgroundColor(this.broker.colorConfig.chartBG).setBodyTextColor(this.broker.colorConfig.textColor).setQuantityTextColor(this.broker.colorConfig.qtyTextColor).setBodyFont(this.broker.colorConfig.font).setQuantityFont(this.broker.colorConfig.font).setLineLength(100).setLineStyle(1)}static getPositionQuantity(t){return et(new te(t).todp(4,te.ROUND_DOWN).toString())}static getPositionPnL(t,r){let s="PnL";const i=new te(t).toFixed(r,te.ROUND_FLOOR);return new te(t).eq(0)?`${s} 0`:new te(t).greaterThan(0)?`${s} +${et(i)}`:`${s} ${et(i)}`}removePositions(){Object.keys(this.positionLines).forEach(t=>{this.positionLines[Number(t)].remove(),delete this.positionLines[Number(t)]})}drawPositionLine(t,r){const s=this.broker.colorConfig,i=t.unrealPnl>=0,n=t.balance>=0;let a=s.pnlZoreColor;const c=new te(t.unrealPnl);c.greaterThan(0)?a=s.upColor:c.lessThan(0)&&(a=s.downColor),i?s.pnlUpColor:s.pnlDownColor;const u=n?s.upColor:s.downColor,m=new te(t.open).toNumber();this.positionLines[r]=this.positionLines[r]??this.getBasePositionLine(),this.positionLines[r].setQuantity(Qt.getPositionQuantity(t.balance)).setPrice(m).setCloseButtonIconColor(s.closeIcon).setCloseButtonBorderColor(u).setBodyBackgroundColor(a).setQuantityTextColor(u).setBodyBorderColor(a).setLineColor(u).setQuantityBorderColor(u).setText(Qt.getPositionPnL(t.unrealPnl,t.unrealPnlDecimal)),this.broker.mode!==3&&this.positionLines[r].onClose(null,()=>{this.broker.closePosition(t)})}},Wt=e=>{if(e!=null)return e.algo_order_id||e.order_id},yn=class{constructor(){this.quantityTpslNoMap=new Map,this.tpslPnlMap=new Map,this.positions=null}getQuantityTpslNoMap(){return this.quantityTpslNoMap}getTpslPnlMap(){return this.tpslPnlMap}getFormattedEstPnl(e){if(this.positions===null)return"";const t=this.positions[0];if(!t)return"";const{estPnl:r}=cn(e,t);return un(r)}prepareTpslPnlMap(e){const t=[];return e.forEach(r=>{const s=Wt(r);if(s&&on(r)){const i=this.tpslPnlMap.get(s),n=this.getFormattedEstPnl(r);i!==n&&(t.push(s),this.tpslPnlMap.set(s,n))}}),t}prepareQuantityTpslNoMap(e){this.quantityTpslNoMap=ln(e)}recalculatePnl(e,t){return this.positions=e,this.prepareTpslPnlMap(t)}clear(){this.positions=null,this.quantityTpslNoMap.clear(),this.tpslPnlMap.clear()}},hs=class Ie{constructor(t,r){this.instance=t,this.pendingOrderLineMap=new Map,this.pendingOrders=[],this.broker=r,this.tpslCalService=new yn}renderPendingOrders(t){t&&(this.pendingOrders=t),this.cleanOldPendingOrders(this.pendingOrders),this.tpslCalService.prepareTpslPnlMap(this.pendingOrders),this.tpslCalService.prepareQuantityTpslNoMap(this.pendingOrders),this.pendingOrders.forEach(r=>this.renderPendingOrder(r))}updatePositions(t){const r=this.tpslCalService.recalculatePnl(t,this.pendingOrders);this.pendingOrders.filter(s=>r.includes(Wt(s))).forEach(s=>this.renderPendingOrder(s))}renderPendingOrder(t){const r=Ie.getOrderId(t);if(!r)return;const s=this.drawOrderLine(r,t);s&&this.pendingOrderLineMap.set(r,s)}cleanOldPendingOrders(t){const r=new Set(t.map(s=>Ie.getOrderId(s)));this.pendingOrderLineMap.forEach((s,i)=>!r.has(i)&&this.removePendingOrder(i))}removePendingOrder(t){if(t===void 0)return;const r=this.pendingOrderLineMap.get(t);r&&(this.pendingOrderLineMap.delete(t),r.remove())}getBaseOrderLine(){const t=this.broker.colorConfig;return this.instance.activeChart().createOrderLine().setCancelTooltip("Cancel Order").setQuantityTextColor(t.qtyTextColor).setQuantityBackgroundColor(t.chartBG).setBodyBackgroundColor(t.chartBG).setCancelButtonBackgroundColor(t.chartBG).setLineStyle(1).setBodyFont(t.font).setQuantityFont(t.font)}static getCombinationType(t){const{algo_type:r,type:s}=t;return(r==="STOP_LOSS"||r==="TAKE_PROFIT"||r==="STOP")&&s==="LIMIT"?"STOP_LIMIT":(r==="STOP_LOSS"||r==="TAKE_PROFIT"||r==="STOP")&&s==="MARKET"?"STOP_MARKET":"LIMIT"}static getText(t){const r=Ie.getCombinationType(t);return r==="STOP_LIMIT"||r==="STOP_MARKET"||r==="STOP_BRACKET_LIMIT"||r==="STOP_BRACKET_MARKET"?t.type==="LIMIT"?`Stop Limit ${et(t.price)}`:"Stop Market":"Limit"}static getOrderPrice(t){return t.trigger_price||t.price}getTPSLTextWithTpsl(t,r){return Wt(r),t}getTPSLText(t){const r=an(t,this.tpslCalService.getQuantityTpslNoMap());return r?this.getTPSLTextWithTpsl(r,t):null}getOrderQuantity(t){if(t.algo_order_id){if(nn(t)||ds(t))return"100%";if(fs(t)){const s=new te(t.quantity).minus(t.executed??0).div(new te(t.position_qty)).mul(100).todp(2).toNumber();return`${Math.min(Math.abs(s),100).toString()}%`}}return et(new te(t.quantity).toString())}drawOrderLine(t,r){const s=us(r)?this.getTPSLText(r):Ie.getText(r);if(s===null)return null;const i=this.broker.colorConfig,n=this.pendingOrderLineMap.get(t)??this.getBaseOrderLine(),a=r.side==="BUY"?i.upColor:i.downColor;r.side==="BUY"?i.pnlUpColor:i.pnlDownColor;const c=Ie.getOrderPrice(r),u=100,m=this.getOrderQuantity(r),f=i.textColor;return n.setText(s).setCancelButtonIconColor(i.closeIcon).setCancelButtonBorderColor(a).setBodyTextColor(f).setBodyBorderColor(a).setQuantityBorderColor(a).setQuantityTextColor(a).setLineColor(a).setLineLength(u).setQuantity(m??"").setPrice(c),this.broker.mode!==3?(n.onCancel(null,()=>this.broker.cancelOrder(r)),this.applyEditOnMove(n,r)):n.setEditable(!1).setCancellable(!1),n}static getOrderEditKey(t){const r=this.getCombinationType(t);if(r==="LIMIT")return"price";if(r==="STOP_LIMIT"||r==="STOP_MARKET"||t.rootAlgoOrderAlgoType==="POSITIONAL_TP_SL"||t.rootAlgoOrderAlgoType==="TP_SL"||t.rootAlgoOrderAlgoType==="BRACKET"||t.rootAlgoOrderAlgoType==="STOP_BRACKET")return"trigger_price"}applyEditOnMove(t,r){const s=Ie.getOrderEditKey(r);t.onMove(()=>{this.broker.editOrder(r,{type:s,value:`${t.getPrice()}`}).then(i=>{i.success||this.renderPendingOrder(r)}).catch(()=>this.renderPendingOrder(r))})}};hs.getOrderId=e=>{if(e!=null)return e.algo_order_id||e.order_id};var bn=hs,_n=class{constructor(e,t,r){this.instance=e,this.positionLineService=new pn(e,r),this.orderLineService=new bn(e,r)}async renderPositions(e){await this.chartReady(),await this.onDataLoaded(),this.positionLineService.renderPositions(e),this.orderLineService.updatePositions(e)}async renderPendingOrders(e){await this.chartReady(),this.orderLineService.renderPendingOrders(e)}remove(){this.positionLineService.removePositions()}onDataLoaded(){return this.instance.activeChart().symbolExt()?Promise.resolve():new Promise(e=>this.instance.activeChart().onDataLoaded().subscribe(null,()=>{e()},!0))}chartReady(){return new Promise(e=>this.instance.onChartReady(()=>{try{this.instance.activeChart().dataReady(()=>e())}catch(t){t.toString().includes("tradingViewApi")||console.log("-- chartReady error",t)}}))}};function vn(e,t){const[r,s]=v.useState(),i=v.useRef(),[{rows:n},a]=$r(e),[c]=kt({status:Ke.INCOMPLETE,symbol:e}),u=v.useRef((f,h,x)=>{i.current&&i.current.remove(),i.current=new _n(f,h,x),s(i.current)}),m=v.useRef(()=>{var f;(f=i.current)==null||f.remove(),i.current=void 0});return v.useEffect(()=>{if(!t||!t.position){r==null||r.renderPositions([]);return}const f=(n??[]).map(h=>({symbol:h.symbol,open:h.average_open_price,balance:h.position_qty,closablePosition:9999,unrealPnl:h.unrealized_pnl,interest:0,unrealPnlDecimal:2,basePriceDecimal:4}));r==null||r.renderPositions(f)},[r,n,e,t]),v.useEffect(()=>{let f=[],h=[],x=[],_=[];const P=(n??[]).find(A=>A.symbol===e);c==null||c.forEach(A=>{if(e===A.symbol){if(!A.algo_order_id)x.push(A);else if(A.algo_order_id)if(A.algo_type==="POSITIONAL_TP_SL")for(const j of A.child_orders)j.root_algo_order_algo_type=A.algo_type,j.trigger_price&&j.status!==Ke.FILLED&&h.push(j);else if(A.algo_type==="TP_SL"){if(P)for(const j of A.child_orders)j.root_algo_order_algo_type=A.algo_type,j.position_qty=P.position_qty,j.trigger_price&&j.status!==Ke.FILLED&&f.push(j)}else(A.algo_type==="STOP_LOSS"||A.algo_type==="TAKE_PROFIT")&&_.push(A)}}),t&&(t.positionTpsl||(h=[]),t.tpsl||(f=[]),t.limitOrders||(x=[]),t.stopOrders||(_=[])),r==null||r.renderPendingOrders(f.concat(h).concat(x).concat(_))},[r,c,e,t,n]),[u.current,m.current]}var xn=(e,t)=>{let r;const s=i=>[null,"limit","MARKET","STOP_MARKET","STOP_LIMIT"][i];return{symbolInfo:async i=>(r=t.getSymbolInfo(Le(i)),{qty:{min:(r==null?void 0:r.baseMin)??0,max:(r==null?void 0:r.baseMax)??0,step:(r==null?void 0:r.baseTick)??0},pipValue:0,pipSize:(r==null?void 0:r.quoteTick)??0,minTick:(r==null?void 0:r.quoteTick)??0,description:""}),placeOrder:async i=>{["SELL","BUY"][+(i.side>0)],i.qty.toString(),(i.limitPrice??0).toString(),(i.stopPrice??0).toString(),i.symbol,s(i.type)},orders:()=>[],positions:()=>[],executions:()=>[],connectionStatus:()=>1,chartContextMenuActions:i=>e.defaultContextMenuActions(i),isTradable:async()=>!0,accountManagerInfo:()=>({}),currentAccount:()=>"1",accountsMetainfo:async()=>[{id:"1"}],remove:()=>e==null?void 0:e.silentOrdersPlacement().unsubscribe()}},Sn=xn;function wn(e){e.setBrokerConnectionAdapter=function(t){const r={subscribe:()=>{},unsubscribe:()=>{},unsubscribeAll:()=>{}};Object.defineProperty(t,"_ordersCache",{get:function(){return{start:()=>{},stop:()=>{},update:()=>{},partialUpdate:()=>{},fullUpdate:()=>{},getObjects:async()=>[],updateDelegate:r,partialUpdateDelegate:r}},set:()=>{}}),t._waitForOrderModification=async()=>!0,this._adapter=t}}function Cn(e,t){e.onChartReady(()=>{t.silentOrdersPlacement().subscribe(r=>{var s;r||(t.silentOrdersPlacement().setValue(!0),e&&(e._iFrame.contentDocument.querySelector(".wrapper-3X2QgaDd").className="wrapper-3X2QgaDd highButtons-3X2QgaDd"),(s=t.sellBuyButtonsVisibility())==null||s.setValue(!1))})})}function jn(e,t){wn(t),Cn(e,t)}function Or(e){return o.jsx("span",{onClick:()=>window.open(e.url),style:{color:"rgba(var(--orderly-color-primary, 1))"},children:e.children})}var Ze="#00B59F",gt="#FB5CB8",gs="#16141c",kn="#27DEC8",Pn="#FFA5C0",Tn="#808080",On="#FFFFFF",En="#F4F7F9",Ln="regular 11px Manrope",Nn=()=>({overrides:{"paneProperties.background":gs,"paneProperties.backgroundType":"solid","mainSeriesProperties.candleStyle.upColor":Ze,"mainSeriesProperties.candleStyle.downColor":gt,"mainSeriesProperties.candleStyle.borderColor":Ze,"mainSeriesProperties.candleStyle.borderUpColor":Ze,"mainSeriesProperties.candleStyle.borderDownColor":gt,"mainSeriesProperties.candleStyle.wickUpColor":Ze,"mainSeriesProperties.candleStyle.wickDownColor":gt,"paneProperties.separatorColor":"#2B2833","paneProperties.vertGridProperties.color":"#26232F","paneProperties.horzGridProperties.color":"#26232F","scalesProperties.textColor":"#97969B","paneProperties.legendProperties.showSeriesTitle":!1},studiesOverrides:{"volume.volume.color.0":"#613155","volume.volume.color.1":"#14494A"}});function An({symbol:e,mode:t=2,libraryPath:r,tradingViewScriptSrc:s,tradingViewCustomCssUrl:i,interval:n,overrides:a,theme:c,studiesOverrides:u,fullscreen:m,closePositionConfirmCallback:f,onToast:h,loadingElement:x,positionControlCallback:_,topToolbarOpenSetting:P,topToolbarOpenIndicators:A,topToolbarLineType:j,displayControlSetting:I,colorConfig:O}){const E=v.useRef(null),k=v.useRef(),D=Ys("apiBaseUrl"),{state:z}=Zt(),V=Gs(Xs),M=Js(),[L,C]=v.useState(!1),w=Object.assign({},{upColor:Ze,downColor:gt,chartBG:gs,pnlUpColor:kn,pnlDownColor:Pn,pnlZoreColor:Tn,textColor:On,qtyTextColor:En,font:Ln,closeIcon:"rgba(255, 255, 255, 0.54)"},O??{}),F=mn({closeConfirm:f,colorConfig:w,onToast:h,mode:t}),[q,H]=vn(e,I),G=v.useRef(null),Q=v.useMemo(()=>!(z.status<er.EnableTrading),[z]);v.useEffect(()=>(k.current&&G.current&&k.current.instance.onChartReady(()=>{var Y;console.log("-- chart ready"),(Y=G.current)==null||Y.style.setProperty("display","none"),Q&&k.current.instance&&q(k.current.instance,void 0,F)}),()=>{H()}),[k.current,Q]),v.useEffect(()=>{if(s&&E.current){const Y=document.createElement("script");Y.setAttribute("data-nscript","afterInteractive"),Y.src=s,Y.async=!0,Y.type="text/javascript",Y.onload=()=>{C(!0)},Y.onerror=()=>{console.log("trading view path error")},E.current.appendChild(Y)}},[E,s]);const ye=()=>{},Me="SDK_Tradingview";return Zi(()=>{if(!L||!s)return;const Y=Nn(),Fe=a?Object.assign({},Y.overrides,a):Y.overrides,dt=u?Object.assign({},Y.studiesOverrides,u):Y.studiesOverrides;if(E.current){const ft={options:{fullscreen:m??!1,autosize:!0,symbol:as(e),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,container:E.current,libraryPath:r,customCssUrl:i,interval:n??"1",theme:c??"dark",overrides:Fe,studiesOverrides:dt,datafeed:new qi(D,M),contextMenu:{items_processor:async Ye=>Ye},getBroker:Q?(Ye,Be)=>(console.log("-- broker_factory"),jn(Ye,Be),Sn(Be,F)):void 0,positionControlCallback:_},chartKey:Me,mode:t,onClick:ye};k.current=new Ji(ft)}return()=>{var He;(He=k.current)==null||He.remove()}},[L,Q,V]),v.useEffect(()=>{var Fe;if(!e||!k.current)return;(Fe=k.current)==null||Fe.setSymbol(e);const Y=new ls(M);return Y.subscribeSymbol(e),()=>{Y.unsubscribeKline(e)}},[e]),v.useEffect(()=>{k.current&&k.current.setSymbol(e,n)},[n]),v.useEffect(()=>{k.current&&k.current.executeActionById("chartProperties")},[P]),v.useEffect(()=>{k.current&&k.current.executeActionById("insertIndicator")},[A]),v.useEffect(()=>{k.current&&k.current.changeLineType(Number(j))},[j]),o.jsxs("div",{style:{height:"100%",width:"100%",margin:"0 auto",position:"relative"},children:[s&&o.jsx("div",{style:{position:"absolute",left:0,right:0,top:0,bottom:0,background:"#16141c",display:"flex",justifyContent:"center",alignItems:"center"},ref:G,children:x??o.jsx("div",{children:"laoding"})}),o.jsx("div",{style:{height:"100%",width:"100%",margin:"0 auto"},ref:E,children:!s&&o.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"},children:o.jsxs("div",{style:{color:"rgb(var(--orderly-color-base-foreground) / 0.98)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"left",height:"100%",padding:"20px",fontSize:"14px",lineHeight:"1.3rem",margin:"0 auto"},children:[o.jsx("p",{style:{marginBottom:"24px"},children:"Due to TradingView's policy, you will need to apply for your own license."}),o.jsxs("p",{style:{marginBottom:"12px"},children:["1. Please apply for your TradingView license"," ",o.jsx(Or,{url:"",children:"here"}),"."]}),o.jsxs("p",{children:["2. Follow the instructions on"," ",o.jsx(Or,{url:"",children:"sdk.orderly.network"})," to set up."]})]})})})]})}const Dn=({symbol:e})=>o.jsx("div",{className:"w-full min-h-[35rem] [&_iframe]:min-h-[35rem]",children:o.jsx(An,{symbol:e,libraryPath:"/tradingview/charting_library/bundles",tradingViewScriptSrc:"/tradingview/charting_library/charting_library.js",tradingViewCustomCssUrl:"/tradingview/chart.css",loadingElement:o.jsx(ie,{size:"2rem",className:"mt-[12rem]"}),overrides:{"mainSeriesProperties.candleStyle.borderDownColor":"#DC2140","mainSeriesProperties.candleStyle.borderUpColor":"#1F8040","mainSeriesProperties.candleStyle.downColor":"#DC2140","mainSeriesProperties.candleStyle.upColor":"#1F8040","mainSeriesProperties.candleStyle.wickDownColor":"#DC2140","mainSeriesProperties.candleStyle.wickUpColor":"#1F8040","paneProperties.background":"#101418","paneProperties.backgroundType":"solid","paneProperties.separatorColor":"#164165","paneProperties.horzGridProperties.color":"#161B22","paneProperties.vertGridProperties.color":"#161B22","paneProperties.legendProperties.showSeriesTitle":"false"}})});function Ot(e){let t=0;e.base_tick<1&&(t=(e.base_tick+"").split(".")[1].length);let r=0;return e.quote_tick<1&&(r=(e.quote_tick+"").split(".")[1].length),[t,r]}const je=e=>o.jsx("span",{className:`${e==null?"h-0":"h-[1.3rem]"} overflow-hidden color-[var(--color-light-red)] transition-duration-300 transition-property-[height] transition-ease-out`,children:(e==null?void 0:e.message)??""});var ut=e=>e.type==="checkbox",Ve=e=>e instanceof Date,ae=e=>e==null;const ms=e=>typeof e=="object";var Z=e=>!ae(e)&&!Array.isArray(e)&&ms(e)&&!Ve(e),ps=e=>Z(e)&&e.target?ut(e.target)?e.target.checked:e.target.value:e,Mn=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,ys=(e,t)=>e.has(Mn(t)),Fn=e=>{const t=e.constructor&&e.constructor.prototype;return Z(t)&&t.hasOwnProperty("isPrototypeOf")},ur=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function le(e){let t;const r=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(ur&&(e instanceof Blob||e instanceof FileList))&&(r||Z(e)))if(t=r?[]:{},!r&&!Fn(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=le(e[s]));else return e;return t}var Et=e=>Array.isArray(e)?e.filter(Boolean):[],J=e=>e===void 0,y=(e,t,r)=>{if(!t||!Z(e))return r;const s=Et(t.split(/[,[\].]+?/)).reduce((i,n)=>ae(i)?i:i[n],e);return J(s)||s===e?J(e[t])?r:e[t]:s},ge=e=>typeof e=="boolean",dr=e=>/^\w*$/.test(e),bs=e=>Et(e.replace(/["|']|\]/g,"").split(/\.|\[/)),K=(e,t,r)=>{let s=-1;const i=dr(t)?[t]:bs(t),n=i.length,a=n-1;for(;++s<n;){const c=i[s];let u=r;if(s!==a){const m=e[c];u=Z(m)||Array.isArray(m)?m:isNaN(+i[s+1])?{}:[]}if(c==="__proto__")return;e[c]=u,e=e[c]}return e};const _t={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},me={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Se={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},Rn=U.createContext(null),fr=()=>U.useContext(Rn);var _s=(e,t,r,s=!0)=>{const i={defaultValues:t._defaultValues};for(const n in e)Object.defineProperty(i,n,{get:()=>{const a=n;return t._proxyFormState[a]!==me.all&&(t._proxyFormState[a]=!s||me.all),r&&(r[a]=!0),e[a]}});return i},ce=e=>Z(e)&&!Object.keys(e).length,vs=(e,t,r,s)=>{r(e);const{name:i,...n}=e;return ce(n)||Object.keys(n).length>=Object.keys(t).length||Object.keys(n).find(a=>t[a]===(!s||me.all))},st=e=>Array.isArray(e)?e:[e],xs=(e,t,r)=>!e||!t||e===t||st(e).some(s=>s&&(r?s===t:s.startsWith(t)||t.startsWith(s)));function hr(e){const t=U.useRef(e);t.current=e,U.useEffect(()=>{const r=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{r&&r.unsubscribe()}},[e.disabled])}function In(e){const t=fr(),{control:r=t.control,disabled:s,name:i,exact:n}=e||{},[a,c]=U.useState(r._formState),u=U.useRef(!0),m=U.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),f=U.useRef(i);return f.current=i,hr({disabled:s,next:h=>u.current&&xs(f.current,h.name,n)&&vs(h,m.current,r._updateFormState)&&c({...r._formState,...h}),subject:r._subjects.state}),U.useEffect(()=>(u.current=!0,m.current.isValid&&r._updateValid(!0),()=>{u.current=!1}),[r]),_s(a,r,m.current,!1)}var ve=e=>typeof e=="string",Ss=(e,t,r,s,i)=>ve(e)?(s&&t.watch.add(e),y(r,e,i)):Array.isArray(e)?e.map(n=>(s&&t.watch.add(n),y(r,n))):(s&&(t.watchAll=!0),r);function Vn(e){const t=fr(),{control:r=t.control,name:s,defaultValue:i,disabled:n,exact:a}=e||{},c=U.useRef(s);c.current=s,hr({disabled:n,subject:r._subjects.values,next:f=>{xs(c.current,f.name,a)&&m(le(Ss(c.current,r._names,f.values||r._formValues,!1,i)))}});const[u,m]=U.useState(r._getWatch(s,i));return U.useEffect(()=>r._removeUnmounted()),u}function Bn(e){const t=fr(),{name:r,disabled:s,control:i=t.control,shouldUnregister:n}=e,a=ys(i._names.array,r),c=Vn({control:i,name:r,defaultValue:y(i._formValues,r,y(i._defaultValues,r,e.defaultValue)),exact:!0}),u=In({control:i,name:r,exact:!0}),m=U.useRef(i.register(r,{...e.rules,value:c,...ge(e.disabled)?{disabled:e.disabled}:{}}));return U.useEffect(()=>{const f=i._options.shouldUnregister||n,h=(x,_)=>{const P=y(i._fields,x);P&&P._f&&(P._f.mount=_)};if(h(r,!0),f){const x=le(y(i._options.defaultValues,r));K(i._defaultValues,r,x),J(y(i._formValues,r))&&K(i._formValues,r,x)}return()=>{(a?f&&!i._state.action:f)?i.unregister(r):h(r,!1)}},[r,i,a,n]),U.useEffect(()=>{y(i._fields,r)&&i._updateDisabledField({disabled:s,fields:i._fields,name:r,value:y(i._fields,r)._f.value})},[s,r,i]),{field:{name:r,value:c,...ge(s)||u.disabled?{disabled:u.disabled||s}:{},onChange:U.useCallback(f=>m.current.onChange({target:{value:ps(f),name:r},type:_t.CHANGE}),[r]),onBlur:U.useCallback(()=>m.current.onBlur({target:{value:y(i._formValues,r),name:r},type:_t.BLUR}),[r,i]),ref:U.useCallback(f=>{const h=y(i._fields,r);h&&f&&(h._f.ref={focus:()=>f.focus(),select:()=>f.select(),setCustomValidity:x=>f.setCustomValidity(x),reportValidity:()=>f.reportValidity()})},[i._fields,r])},formState:u,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!y(u.errors,r)},isDirty:{enumerable:!0,get:()=>!!y(u.dirtyFields,r)},isTouched:{enumerable:!0,get:()=>!!y(u.touchedFields,r)},isValidating:{enumerable:!0,get:()=>!!y(u.validatingFields,r)},error:{enumerable:!0,get:()=>y(u.errors,r)}})}}const ke=e=>e.render(Bn(e));var qn=(e,t,r,s,i)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[s]:i||!0}}:{},Er=e=>({isOnSubmit:!e||e===me.onSubmit,isOnBlur:e===me.onBlur,isOnChange:e===me.onChange,isOnAll:e===me.all,isOnTouch:e===me.onTouched}),Lr=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const it=(e,t,r,s)=>{for(const i of r||Object.keys(e)){const n=y(e,i);if(n){const{_f:a,...c}=n;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],i)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if(it(c,t))break}else if(Z(c)&&it(c,t))break}}};var $n=(e,t,r)=>{const s=st(y(e,r));return K(s,"root",t[r]),K(e,r,s),e},gr=e=>e.type==="file",we=e=>typeof e=="function",vt=e=>{if(!ur)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},mt=e=>ve(e),mr=e=>e.type==="radio",xt=e=>e instanceof RegExp;const Nr={value:!1,isValid:!1},Ar={value:!0,isValid:!0};var ws=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!J(e[0].attributes.value)?J(e[0].value)||e[0].value===""?Ar:{value:e[0].value,isValid:!0}:Ar:Nr}return Nr};const Dr={isValid:!1,value:null};var Cs=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,Dr):Dr;function Mr(e,t,r="validate"){if(mt(e)||Array.isArray(e)&&e.every(mt)||ge(e)&&!e)return{type:r,message:mt(e)?e:"",ref:t}}var $e=e=>Z(e)&&!xt(e)?e:{value:e,message:""},Fr=async(e,t,r,s,i)=>{const{ref:n,refs:a,required:c,maxLength:u,minLength:m,min:f,max:h,pattern:x,validate:_,name:P,valueAsNumber:A,mount:j,disabled:I}=e._f,O=y(t,P);if(!j||I)return{};const E=a?a[0]:n,k=w=>{s&&E.reportValidity&&(E.setCustomValidity(ge(w)?"":w||""),E.reportValidity())},D={},z=mr(n),V=ut(n),M=z||V,L=(A||gr(n))&&J(n.value)&&J(O)||vt(n)&&n.value===""||O===""||Array.isArray(O)&&!O.length,C=qn.bind(null,P,r,D),N=(w,F,q,H=Se.maxLength,G=Se.minLength)=>{const Q=w?F:q;D[P]={type:w?H:G,message:Q,ref:n,...C(w?H:G,Q)}};if(i?!Array.isArray(O)||!O.length:c&&(!M&&(L||ae(O))||ge(O)&&!O||V&&!ws(a).isValid||z&&!Cs(a).isValid)){const{value:w,message:F}=mt(c)?{value:!!c,message:c}:$e(c);if(w&&(D[P]={type:Se.required,message:F,ref:E,...C(Se.required,F)},!r))return k(F),D}if(!L&&(!ae(f)||!ae(h))){let w,F;const q=$e(h),H=$e(f);if(!ae(O)&&!isNaN(O)){const G=n.valueAsNumber||O&&+O;ae(q.value)||(w=G>q.value),ae(H.value)||(F=G<H.value)}else{const G=n.valueAsDate||new Date(O),Q=Y=>new Date(new Date().toDateString()+" "+Y),ye=n.type=="time",Me=n.type=="week";ve(q.value)&&O&&(w=ye?Q(O)>Q(q.value):Me?O>q.value:G>new Date(q.value)),ve(H.value)&&O&&(F=ye?Q(O)<Q(H.value):Me?O<H.value:G<new Date(H.value))}if((w||F)&&(N(!!w,q.message,H.message,Se.max,Se.min),!r))return k(D[P].message),D}if((u||m)&&!L&&(ve(O)||i&&Array.isArray(O))){const w=$e(u),F=$e(m),q=!ae(w.value)&&O.length>+w.value,H=!ae(F.value)&&O.length<+F.value;if((q||H)&&(N(q,w.message,F.message),!r))return k(D[P].message),D}if(x&&!L&&ve(O)){const{value:w,message:F}=$e(x);if(xt(w)&&!O.match(w)&&(D[P]={type:Se.pattern,message:F,ref:n,...C(Se.pattern,F)},!r))return k(F),D}if(_){if(we(_)){const w=await _(O,t),F=Mr(w,E);if(F&&(D[P]={...F,...C(Se.validate,F.message)},!r))return k(F.message),D}else if(Z(_)){let w={};for(const F in _){if(!ce(w)&&!r)break;const q=Mr(await _[F](O,t),E,F);q&&(w={...q,...C(F,q.message)},k(q.message),r&&(D[P]=w))}if(!ce(w)&&(D[P]={ref:E,...w},!r))return D}}return k(!0),D};function Un(e,t){const r=t.slice(0,-1).length;let s=0;for(;s<r;)e=J(e)?s++:e[t[s++]];return e}function Kn(e){for(const t in e)if(e.hasOwnProperty(t)&&!J(e[t]))return!1;return!0}function ee(e,t){const r=Array.isArray(t)?t:dr(t)?[t]:bs(t),s=r.length===1?e:Un(e,r),i=r.length-1,n=r[i];return s&&delete s[n],i!==0&&(Z(s)&&ce(s)||Array.isArray(s)&&Kn(s))&&ee(e,r.slice(0,-1)),e}var Ft=()=>{let e=[];return{get observers(){return e},next:i=>{for(const n of e)n.next&&n.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(n=>n!==i)}}),unsubscribe:()=>{e=[]}}},Ht=e=>ae(e)||!ms(e);function Ne(e,t){if(Ht(e)||Ht(t))return e===t;if(Ve(e)&&Ve(t))return e.getTime()===t.getTime();const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const i of r){const n=e[i];if(!s.includes(i))return!1;if(i!=="ref"){const a=t[i];if(Ve(n)&&Ve(a)||Z(n)&&Z(a)||Array.isArray(n)&&Array.isArray(a)?!Ne(n,a):n!==a)return!1}}return!0}var js=e=>e.type==="select-multiple",zn=e=>mr(e)||ut(e),Rt=e=>vt(e)&&e.isConnected,ks=e=>{for(const t in e)if(we(e[t]))return!0;return!1};function St(e,t={}){const r=Array.isArray(e);if(Z(e)||r)for(const s in e)Array.isArray(e[s])||Z(e[s])&&!ks(e[s])?(t[s]=Array.isArray(e[s])?[]:{},St(e[s],t[s])):ae(e[s])||(t[s]=!0);return t}function Ps(e,t,r){const s=Array.isArray(e);if(Z(e)||s)for(const i in e)Array.isArray(e[i])||Z(e[i])&&!ks(e[i])?J(t)||Ht(r[i])?r[i]=Array.isArray(e[i])?St(e[i],[]):{...St(e[i])}:Ps(e[i],ae(t)?{}:t[i],r[i]):r[i]=!Ne(e[i],t[i]);return r}var Ge=(e,t)=>Ps(e,t,St(t)),Ts=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:s})=>J(e)?e:t?e===""?NaN:e&&+e:r&&ve(e)?new Date(e):s?s(e):e;function It(e){const t=e.ref;if(!(e.refs?e.refs.every(r=>r.disabled):t.disabled))return gr(t)?t.files:mr(t)?Cs(e.refs).value:js(t)?[...t.selectedOptions].map(({value:r})=>r):ut(t)?ws(e.refs).value:Ts(J(t.value)?e.ref.value:t.value,e)}var Qn=(e,t,r,s)=>{const i={};for(const n of e){const a=y(t,n);a&&K(i,n,a._f)}return{criteriaMode:r,names:[...e],fields:i,shouldUseNativeValidation:s}},Je=e=>J(e)?e:xt(e)?e.source:Z(e)?xt(e.value)?e.value.source:e.value:e;const Rr="AsyncFunction";var Wn=e=>(!e||!e.validate)&&!!(we(e.validate)&&e.validate.constructor.name===Rr||Z(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===Rr)),Hn=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function Ir(e,t,r){const s=y(e,r);if(s||dr(r))return{error:s,name:r};const i=r.split(".");for(;i.length;){const n=i.join("."),a=y(t,n),c=y(e,n);if(a&&!Array.isArray(a)&&r!==n)return{name:r};if(c&&c.type)return{name:n,error:c};i.pop()}return{name:r}}var Yn=(e,t,r,s,i)=>i.isOnAll?!1:!r&&i.isOnTouch?!(t||e):(r?s.isOnBlur:i.isOnBlur)?!e:(r?s.isOnChange:i.isOnChange)?e:!0,Gn=(e,t)=>!Et(y(e,t)).length&&ee(e,t);const Jn={mode:me.onSubmit,reValidateMode:me.onChange,shouldFocusError:!0};function Xn(e={}){let t={...Jn,...e},r={submitCount:0,isDirty:!1,isLoading:we(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},i=Z(t.defaultValues)||Z(t.values)?le(t.defaultValues||t.values)||{}:{},n=t.shouldUnregister?{}:le(i),a={action:!1,mount:!1,watch:!1},c={mount:new Set,unMount:new Set,array:new Set,watch:new Set},u,m=0;const f={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},h={values:Ft(),array:Ft(),state:Ft()},x=Er(t.mode),_=Er(t.reValidateMode),P=t.criteriaMode===me.all,A=l=>d=>{clearTimeout(m),m=setTimeout(l,d)},j=async l=>{if(!e.disabled&&(f.isValid||l)){const d=t.resolver?ce((await M()).errors):await C(s,!0);d!==r.isValid&&h.state.next({isValid:d})}},I=(l,d)=>{!e.disabled&&(f.isValidating||f.validatingFields)&&((l||Array.from(c.mount)).forEach(g=>{g&&(d?K(r.validatingFields,g,d):ee(r.validatingFields,g))}),h.state.next({validatingFields:r.validatingFields,isValidating:!ce(r.validatingFields)}))},O=(l,d=[],g,S,b=!0,p=!0)=>{if(S&&g&&!e.disabled){if(a.action=!0,p&&Array.isArray(y(s,l))){const T=g(y(s,l),S.argA,S.argB);b&&K(s,l,T)}if(p&&Array.isArray(y(r.errors,l))){const T=g(y(r.errors,l),S.argA,S.argB);b&&K(r.errors,l,T),Gn(r.errors,l)}if(f.touchedFields&&p&&Array.isArray(y(r.touchedFields,l))){const T=g(y(r.touchedFields,l),S.argA,S.argB);b&&K(r.touchedFields,l,T)}f.dirtyFields&&(r.dirtyFields=Ge(i,n)),h.state.next({name:l,isDirty:w(l,d),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else K(n,l,d)},E=(l,d)=>{K(r.errors,l,d),h.state.next({errors:r.errors})},k=l=>{r.errors=l,h.state.next({errors:r.errors,isValid:!1})},D=(l,d,g,S)=>{const b=y(s,l);if(b){const p=y(n,l,J(g)?y(i,l):g);J(p)||S&&S.defaultChecked||d?K(n,l,d?p:It(b._f)):H(l,p),a.mount&&j()}},z=(l,d,g,S,b)=>{let p=!1,T=!1;const R={name:l};if(!e.disabled){const re=!!(y(s,l)&&y(s,l)._f&&y(s,l)._f.disabled);if(!g||S){f.isDirty&&(T=r.isDirty,r.isDirty=R.isDirty=w(),p=T!==R.isDirty);const se=re||Ne(y(i,l),d);T=!!(!re&&y(r.dirtyFields,l)),se||re?ee(r.dirtyFields,l):K(r.dirtyFields,l,!0),R.dirtyFields=r.dirtyFields,p=p||f.dirtyFields&&T!==!se}if(g){const se=y(r.touchedFields,l);se||(K(r.touchedFields,l,g),R.touchedFields=r.touchedFields,p=p||f.touchedFields&&se!==g)}p&&b&&h.state.next(R)}return p?R:{}},V=(l,d,g,S)=>{const b=y(r.errors,l),p=f.isValid&&ge(d)&&r.isValid!==d;if(e.delayError&&g?(u=A(()=>E(l,g)),u(e.delayError)):(clearTimeout(m),u=null,g?K(r.errors,l,g):ee(r.errors,l)),(g?!Ne(b,g):b)||!ce(S)||p){const T={...S,...p&&ge(d)?{isValid:d}:{},errors:r.errors,name:l};r={...r,...T},h.state.next(T)}},M=async l=>{I(l,!0);const d=await t.resolver(n,t.context,Qn(l||c.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return I(l),d},L=async l=>{const{errors:d}=await M(l);if(l)for(const g of l){const S=y(d,g);S?K(r.errors,g,S):ee(r.errors,g)}else r.errors=d;return d},C=async(l,d,g={valid:!0})=>{for(const S in l){const b=l[S];if(b){const{_f:p,...T}=b;if(p){const R=c.array.has(p.name),re=b._f&&Wn(b._f);re&&f.validatingFields&&I([S],!0);const se=await Fr(b,n,P,t.shouldUseNativeValidation&&!d,R);if(re&&f.validatingFields&&I([S]),se[p.name]&&(g.valid=!1,d))break;!d&&(y(se,p.name)?R?$n(r.errors,se,p.name):K(r.errors,p.name,se[p.name]):ee(r.errors,p.name))}!ce(T)&&await C(T,d,g)}}return g.valid},N=()=>{for(const l of c.unMount){const d=y(s,l);d&&(d._f.refs?d._f.refs.every(g=>!Rt(g)):!Rt(d._f.ref))&&Be(l)}c.unMount=new Set},w=(l,d)=>!e.disabled&&(l&&d&&K(n,l,d),!Ne(Fe(),i)),F=(l,d,g)=>Ss(l,c,{...a.mount?n:J(d)?i:ve(l)?{[l]:d}:d},g,d),q=l=>Et(y(a.mount?n:i,l,e.shouldUnregister?y(i,l,[]):[])),H=(l,d,g={})=>{const S=y(s,l);let b=d;if(S){const p=S._f;p&&(!p.disabled&&K(n,l,Ts(d,p)),b=vt(p.ref)&&ae(d)?"":d,js(p.ref)?[...p.ref.options].forEach(T=>T.selected=b.includes(T.value)):p.refs?ut(p.ref)?p.refs.length>1?p.refs.forEach(T=>(!T.defaultChecked||!T.disabled)&&(T.checked=Array.isArray(b)?!!b.find(R=>R===T.value):b===T.value)):p.refs[0]&&(p.refs[0].checked=!!b):p.refs.forEach(T=>T.checked=T.value===b):gr(p.ref)?p.ref.value="":(p.ref.value=b,p.ref.type||h.values.next({name:l,values:{...n}})))}(g.shouldDirty||g.shouldTouch)&&z(l,b,g.shouldTouch,g.shouldDirty,!0),g.shouldValidate&&Y(l)},G=(l,d,g)=>{for(const S in d){const b=d[S],p=`${l}.${S}`,T=y(s,p);(c.array.has(l)||Z(b)||T&&!T._f)&&!Ve(b)?G(p,b,g):H(p,b,g)}},Q=(l,d,g={})=>{const S=y(s,l),b=c.array.has(l),p=le(d);K(n,l,p),b?(h.array.next({name:l,values:{...n}}),(f.isDirty||f.dirtyFields)&&g.shouldDirty&&h.state.next({name:l,dirtyFields:Ge(i,n),isDirty:w(l,p)})):S&&!S._f&&!ae(p)?G(l,p,g):H(l,p,g),Lr(l,c)&&h.state.next({...r}),h.values.next({name:a.mount?l:void 0,values:{...n}})},ye=async l=>{a.mount=!0;const d=l.target;let g=d.name,S=!0;const b=y(s,g),p=()=>d.type?It(b._f):ps(l),T=R=>{S=Number.isNaN(R)||Ve(R)&&isNaN(R.getTime())||Ne(R,y(n,g,R))};if(b){let R,re;const se=p(),Re=l.type===_t.BLUR||l.type===_t.FOCUS_OUT,Fs=!Hn(b._f)&&!t.resolver&&!y(r.errors,g)&&!b._f.deps||Yn(Re,y(r.touchedFields,g),r.isSubmitted,_,x),At=Lr(g,c,Re);K(n,g,se),Re?(b._f.onBlur&&b._f.onBlur(l),u&&u(0)):b._f.onChange&&b._f.onChange(l);const Dt=z(g,se,Re,!1),Rs=!ce(Dt)||At;if(!Re&&h.values.next({name:g,type:l.type,values:{...n}}),Fs)return f.isValid&&(e.mode==="onBlur"?Re&&j():j()),Rs&&h.state.next({name:g,...At?{}:Dt});if(!Re&&At&&h.state.next({...r}),t.resolver){const{errors:Sr}=await M([g]);if(T(se),S){const Is=Ir(r.errors,s,g),wr=Ir(Sr,s,Is.name||g);R=wr.error,g=wr.name,re=ce(Sr)}}else I([g],!0),R=(await Fr(b,n,P,t.shouldUseNativeValidation))[g],I([g]),T(se),S&&(R?re=!1:f.isValid&&(re=await C(s,!0)));S&&(b._f.deps&&Y(b._f.deps),V(g,re,R,Dt))}},Me=(l,d)=>{if(y(r.errors,d)&&l.focus)return l.focus(),1},Y=async(l,d={})=>{let g,S;const b=st(l);if(t.resolver){const p=await L(J(l)?l:b);g=ce(p),S=l?!b.some(T=>y(p,T)):g}else l?(S=(await Promise.all(b.map(async p=>{const T=y(s,p);return await C(T&&T._f?{[p]:T}:T)}))).every(Boolean),!(!S&&!r.isValid)&&j()):S=g=await C(s);return h.state.next({...!ve(l)||f.isValid&&g!==r.isValid?{}:{name:l},...t.resolver||!l?{isValid:g}:{},errors:r.errors}),d.shouldFocus&&!S&&it(s,Me,l?b:c.mount),S},Fe=l=>{const d={...a.mount?n:i};return J(l)?d:ve(l)?y(d,l):l.map(g=>y(d,g))},dt=(l,d)=>({invalid:!!y((d||r).errors,l),isDirty:!!y((d||r).dirtyFields,l),error:y((d||r).errors,l),isValidating:!!y(r.validatingFields,l),isTouched:!!y((d||r).touchedFields,l)}),He=l=>{l&&st(l).forEach(d=>ee(r.errors,d)),h.state.next({errors:l?r.errors:{}})},ft=(l,d,g)=>{const S=(y(s,l,{_f:{}})._f||{}).ref,b=y(r.errors,l)||{},{ref:p,message:T,type:R,...re}=b;K(r.errors,l,{...re,...d,ref:S}),h.state.next({name:l,errors:r.errors,isValid:!1}),g&&g.shouldFocus&&S&&S.focus&&S.focus()},Ye=(l,d)=>we(l)?h.values.subscribe({next:g=>l(F(void 0,d),g)}):F(l,d,!0),Be=(l,d={})=>{for(const g of l?st(l):c.mount)c.mount.delete(g),c.array.delete(g),d.keepValue||(ee(s,g),ee(n,g)),!d.keepError&&ee(r.errors,g),!d.keepDirty&&ee(r.dirtyFields,g),!d.keepTouched&&ee(r.touchedFields,g),!d.keepIsValidating&&ee(r.validatingFields,g),!t.shouldUnregister&&!d.keepDefaultValue&&ee(i,g);h.values.next({values:{...n}}),h.state.next({...r,...d.keepDirty?{isDirty:w()}:{}}),!d.keepIsValid&&j()},yr=({disabled:l,name:d,field:g,fields:S,value:b})=>{if(ge(l)&&a.mount||l){const p=l?void 0:J(b)?It(g?g._f:y(S,d)._f):b;K(n,d,p),z(d,p,!1,!1,!0)}},Nt=(l,d={})=>{let g=y(s,l);const S=ge(d.disabled)||ge(e.disabled);return K(s,l,{...g||{},_f:{...g&&g._f?g._f:{ref:{name:l}},name:l,mount:!0,...d}}),c.mount.add(l),g?yr({field:g,disabled:ge(d.disabled)?d.disabled:e.disabled,name:l,value:d.value}):D(l,!0,d.value),{...S?{disabled:d.disabled||e.disabled}:{},...t.progressive?{required:!!d.required,min:Je(d.min),max:Je(d.max),minLength:Je(d.minLength),maxLength:Je(d.maxLength),pattern:Je(d.pattern)}:{},name:l,onChange:ye,onBlur:ye,ref:b=>{if(b){Nt(l,d),g=y(s,l);const p=J(b.value)&&b.querySelectorAll&&b.querySelectorAll("input,select,textarea")[0]||b,T=zn(p),R=g._f.refs||[];if(T?R.find(re=>re===p):p===g._f.ref)return;K(s,l,{_f:{...g._f,...T?{refs:[...R.filter(Rt),p,...Array.isArray(y(i,l))?[{}]:[]],ref:{type:p.type,name:l}}:{ref:p}}}),D(l,!1,void 0,p)}else g=y(s,l,{}),g._f&&(g._f.mount=!1),(t.shouldUnregister||d.shouldUnregister)&&!(ys(c.array,l)&&a.action)&&c.unMount.add(l)}}},br=()=>t.shouldFocusError&&it(s,Me,c.mount),Ds=l=>{ge(l)&&(h.state.next({disabled:l}),it(s,(d,g)=>{const S=y(s,g);S&&(d.disabled=S._f.disabled||l,Array.isArray(S._f.refs)&&S._f.refs.forEach(b=>{b.disabled=S._f.disabled||l}))},0,!1))},_r=(l,d)=>async g=>{let S;g&&(g.preventDefault&&g.preventDefault(),g.persist&&g.persist());let b=le(n);if(h.state.next({isSubmitting:!0}),t.resolver){const{errors:p,values:T}=await M();r.errors=p,b=T}else await C(s);if(ee(r.errors,"root"),ce(r.errors)){h.state.next({errors:{}});try{await l(b,g)}catch(p){S=p}}else d&&await d({...r.errors},g),br(),setTimeout(br);if(h.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:ce(r.errors)&&!S,submitCount:r.submitCount+1,errors:r.errors}),S)throw S},Ms=(l,d={})=>{y(s,l)&&(J(d.defaultValue)?Q(l,le(y(i,l))):(Q(l,d.defaultValue),K(i,l,le(d.defaultValue))),d.keepTouched||ee(r.touchedFields,l),d.keepDirty||(ee(r.dirtyFields,l),r.isDirty=d.defaultValue?w(l,le(y(i,l))):w()),d.keepError||(ee(r.errors,l),f.isValid&&j()),h.state.next({...r}))},vr=(l,d={})=>{const g=l?le(l):i,S=le(g),b=ce(l),p=b?i:S;if(d.keepDefaultValues||(i=g),!d.keepValues){if(d.keepDirtyValues){const T=new Set([...c.mount,...Object.keys(Ge(i,n))]);for(const R of Array.from(T))y(r.dirtyFields,R)?K(p,R,y(n,R)):Q(R,y(p,R))}else{if(ur&&J(l))for(const T of c.mount){const R=y(s,T);if(R&&R._f){const re=Array.isArray(R._f.refs)?R._f.refs[0]:R._f.ref;if(vt(re)){const se=re.closest("form");if(se){se.reset();break}}}}s={}}n=e.shouldUnregister?d.keepDefaultValues?le(i):{}:le(p),h.array.next({values:{...p}}),h.values.next({values:{...p}})}c={mount:d.keepDirtyValues?c.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!f.isValid||!!d.keepIsValid||!!d.keepDirtyValues,a.watch=!!e.shouldUnregister,h.state.next({submitCount:d.keepSubmitCount?r.submitCount:0,isDirty:b?!1:d.keepDirty?r.isDirty:!!(d.keepDefaultValues&&!Ne(l,i)),isSubmitted:d.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:b?{}:d.keepDirtyValues?d.keepDefaultValues&&n?Ge(i,n):r.dirtyFields:d.keepDefaultValues&&l?Ge(i,l):d.keepDirty?r.dirtyFields:{},touchedFields:d.keepTouched?r.touchedFields:{},errors:d.keepErrors?r.errors:{},isSubmitSuccessful:d.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},xr=(l,d)=>vr(we(l)?l(n):l,d);return{control:{register:Nt,unregister:Be,getFieldState:dt,handleSubmit:_r,setError:ft,_executeSchema:M,_getWatch:F,_getDirty:w,_updateValid:j,_removeUnmounted:N,_updateFieldArray:O,_updateDisabledField:yr,_getFieldArray:q,_reset:vr,_resetDefaultValues:()=>we(t.defaultValues)&&t.defaultValues().then(l=>{xr(l,t.resetOptions),h.state.next({isLoading:!1})}),_updateFormState:l=>{r={...r,...l}},_disableForm:Ds,_subjects:h,_proxyFormState:f,_setErrors:k,get _fields(){return s},get _formValues(){return n},get _state(){return a},set _state(l){a=l},get _defaultValues(){return i},get _names(){return c},set _names(l){c=l},get _formState(){return r},set _formState(l){r=l},get _options(){return t},set _options(l){t={...t,...l}}},trigger:Y,register:Nt,handleSubmit:_r,watch:Ye,setValue:Q,getValues:Fe,reset:xr,resetField:Ms,clearErrors:He,unregister:Be,setError:ft,setFocus:(l,d={})=>{const g=y(s,l),S=g&&g._f;if(S){const b=S.refs?S.refs[0]:S.ref;b.focus&&(b.focus(),d.shouldSelect&&b.select())}},getFieldState:dt}}function Lt(e={}){const t=U.useRef(),r=U.useRef(),[s,i]=U.useState({isDirty:!1,isValidating:!1,isLoading:we(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:we(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...Xn(e),formState:s});const n=t.current.control;return n._options=e,hr({subject:n._subjects.state,next:a=>{vs(a,n._proxyFormState,n._updateFormState,!0)&&i({...n._formState})}}),U.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),U.useEffect(()=>{if(n._proxyFormState.isDirty){const a=n._getDirty();a!==s.isDirty&&n._subjects.state.next({isDirty:a})}},[n,s.isDirty]),U.useEffect(()=>{e.values&&!Ne(e.values,r.current)?(n._reset(e.values,n._options.resetOptions),r.current=e.values,i(a=>({...a}))):n._resetDefaultValues()},[e.values,n]),U.useEffect(()=>{e.errors&&n._setErrors(e.errors)},[e.errors,n]),U.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),U.useEffect(()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[e.shouldUnregister,n]),U.useEffect(()=>{t.current&&(t.current.watch=t.current.watch.bind({}))},[s]),t.current.formState=_s(s,n),t.current}const Zn=({symbol:e,position:t,refresh:r,setOpen:s})=>{const[i,n]=v.useState(!1),a=lt(),{register:c,handleSubmit:u,control:m}=Lt({defaultValues:{direction:t.position_qty>0?xe.SELL:xe.BUY,type:pe.MARKET,quantity:t.position_qty}}),{onSubmit:f,helper:h}=tr({symbol:e,side:xe.BUY,order_type:pe.MARKET},{watchOrderbook:!0}),[x,_]=ct();if(a.isNil)return o.jsx(ie,{});const P=async E=>{n(!0);const{update:k}=_({eventCode:"closePosition",type:"pending",message:"Closing position..."});try{await f(Os(E,e)),k({eventCode:"closePositionSuccess",type:"success",message:"Successfully closed position!",autoDismiss:5e3})}catch(D){console.error('Unhandled error in "submitForm":',D),k({eventCode:"closePositionError",type:"error",message:"Closing position failed!",autoDismiss:5e3})}finally{n(!1),r(),s(!1)}},A=a[e](),[j,I]=e.split("_"),[O]=Ot(A);return o.jsxs("form",{className:"flex flex-1 flex-col gap-6 w-full",onSubmit:u(P),children:[o.jsx("div",{children:"Partially or fully close your open position at mark price."}),o.jsx("input",{className:"hidden",...c("direction")}),o.jsx("input",{className:"hidden",...c("type")}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Quantity (",I,")"]}),o.jsx(ke,{name:"quantity",control:m,rules:{validate:{custom:async(E,k)=>{const D=await eo(k,e,h.validator);return(D==null?void 0:D.order_quantity)!=null?D.order_quantity.message:!0}}},render:({field:{name:E,onBlur:k,onChange:D,value:z},fieldState:{error:V}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`mb-2 ${V!=null?"border-[var(--color-red)]":""}`,decimals:O,placeholder:"Quantity",name:E,onBlur:k,onChange:D,value:z,onValueChange:M=>{z=M.toString()},min:Qe.fromString("0"),max:Qe.fromString(String(t.position_qty)),hasError:V!=null}),o.jsx(Tt,{value:[Number(z)],defaultValue:[100],variant:"surface",name:E,onValueChange:M=>{D(M[0])},onValueCommit:k,min:0,max:t.position_qty,step:A.base_tick}),o.jsxs("div",{className:"font-size-[1.1rem] flex w-full justify-center my-1",children:[z," ",I]}),je(V)]})})]}),o.jsxs("button",{type:"submit",disabled:i,className:"relative py-2 font-size-5 bg-[var(--accent-9)] hover:bg-[var(--accent-10)] border-rd-1 border-0",children:[i&&o.jsx(ie,{overlay:!0})," Close Position"]})]})};async function eo(e,t,r){return r(Os(e,t))}function Os(e,t){return{symbol:t,side:e.direction,order_type:e.type,order_quantity:String(e.quantity),reduce_only:!0}}const fe=Symbol.for("@ts-pattern/matcher"),Es=Symbol.for("@ts-pattern/isVariadic"),wt="@ts-pattern/anonymous-select-key",Yt=e=>!!(e&&typeof e=="object"),pt=e=>e&&!!e[fe],ne=(e,t,r)=>{if(pt(e)){const s=e[fe](),{matched:i,selections:n}=s.match(t);return i&&n&&Object.keys(n).forEach(a=>r(a,n[a])),i}if(Yt(e)){if(!Yt(t))return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let s=[],i=[],n=[];for(const a of e.keys()){const c=e[a];pt(c)&&c[Es]?n.push(c):n.length?i.push(c):s.push(c)}if(n.length){if(n.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(t.length<s.length+i.length)return!1;const a=t.slice(0,s.length),c=i.length===0?[]:t.slice(-i.length),u=t.slice(s.length,i.length===0?1/0:-i.length);return s.every((m,f)=>ne(m,a[f],r))&&i.every((m,f)=>ne(m,c[f],r))&&(n.length===0||ne(n[0],u,r))}return e.length===t.length&&e.every((a,c)=>ne(a,t[c],r))}return Reflect.ownKeys(e).every(s=>{const i=e[s];return(s in t||pt(n=i)&&n[fe]().matcherType==="optional")&&ne(i,t[s],r);var n})}return Object.is(t,e)},he=e=>{var t,r,s;return Yt(e)?pt(e)?(t=(r=(s=e[fe]()).getSelectionKeys)==null?void 0:r.call(s))!=null?t:[]:Array.isArray(e)?nt(e,he):nt(Object.values(e),he):[]},nt=(e,t)=>e.reduce((r,s)=>r.concat(t(s)),[]);function to(...e){if(e.length===1){const[t]=e;return r=>ne(t,r,()=>{})}if(e.length===2){const[t,r]=e;return ne(t,r,()=>{})}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${e.length}.`)}function oe(e){return Object.assign(e,{optional:()=>pr(e),and:t=>W(e,t),or:t=>Ls(e,t),select:t=>t===void 0?ot(e):ot(t,e)})}function Gt(e){return Object.assign((t=>Object.assign(t,{[Symbol.iterator](){let r=0;const s=[{value:Object.assign(t,{[Es]:!0}),done:!1},{done:!0,value:void 0}];return{next:()=>{var i;return(i=s[r++])!=null?i:s.at(-1)}}}}))(e),{optional:()=>Gt(pr(e)),select:t=>Gt(t===void 0?ot(e):ot(t,e))})}function pr(e){return oe({[fe]:()=>({match:t=>{let r={};const s=(i,n)=>{r[i]=n};return t===void 0?(he(e).forEach(i=>s(i,void 0)),{matched:!0,selections:r}):{matched:ne(e,t,s),selections:r}},getSelectionKeys:()=>he(e),matcherType:"optional"})})}const ro=(e,t)=>{for(const r of e)if(!t(r))return!1;return!0},so=(e,t)=>{for(const[r,s]of e.entries())if(!t(s,r))return!1;return!0};function W(...e){return oe({[fe]:()=>({match:t=>{let r={};const s=(i,n)=>{r[i]=n};return{matched:e.every(i=>ne(i,t,s)),selections:r}},getSelectionKeys:()=>nt(e,he),matcherType:"and"})})}function Ls(...e){return oe({[fe]:()=>({match:t=>{let r={};const s=(i,n)=>{r[i]=n};return nt(e,he).forEach(i=>s(i,void 0)),{matched:e.some(i=>ne(i,t,s)),selections:r}},getSelectionKeys:()=>nt(e,he),matcherType:"or"})})}function B(e){return{[fe]:()=>({match:t=>({matched:!!e(t)})})}}function ot(...e){const t=typeof e[0]=="string"?e[0]:void 0,r=e.length===2?e[1]:typeof e[0]=="string"?void 0:e[0];return oe({[fe]:()=>({match:s=>{let i={[t??wt]:s};return{matched:r===void 0||ne(r,s,(n,a)=>{i[n]=a}),selections:i}},getSelectionKeys:()=>[t??wt].concat(r===void 0?[]:he(r))})})}function be(e){return typeof e=="number"}function Pe(e){return typeof e=="string"}function Te(e){return typeof e=="bigint"}const Ns=oe(B(function(e){return!0})),io=Ns,Oe=e=>Object.assign(oe(e),{startsWith:t=>{return Oe(W(e,(r=t,B(s=>Pe(s)&&s.startsWith(r)))));var r},endsWith:t=>{return Oe(W(e,(r=t,B(s=>Pe(s)&&s.endsWith(r)))));var r},minLength:t=>Oe(W(e,(r=>B(s=>Pe(s)&&s.length>=r))(t))),length:t=>Oe(W(e,(r=>B(s=>Pe(s)&&s.length===r))(t))),maxLength:t=>Oe(W(e,(r=>B(s=>Pe(s)&&s.length<=r))(t))),includes:t=>{return Oe(W(e,(r=t,B(s=>Pe(s)&&s.includes(r)))));var r},regex:t=>{return Oe(W(e,(r=t,B(s=>Pe(s)&&!!s.match(r)))));var r}}),no=Oe(B(Pe)),_e=e=>Object.assign(oe(e),{between:(t,r)=>_e(W(e,((s,i)=>B(n=>be(n)&&s<=n&&i>=n))(t,r))),lt:t=>_e(W(e,(r=>B(s=>be(s)&&s<r))(t))),gt:t=>_e(W(e,(r=>B(s=>be(s)&&s>r))(t))),lte:t=>_e(W(e,(r=>B(s=>be(s)&&s<=r))(t))),gte:t=>_e(W(e,(r=>B(s=>be(s)&&s>=r))(t))),int:()=>_e(W(e,B(t=>be(t)&&Number.isInteger(t)))),finite:()=>_e(W(e,B(t=>be(t)&&Number.isFinite(t)))),positive:()=>_e(W(e,B(t=>be(t)&&t>0))),negative:()=>_e(W(e,B(t=>be(t)&&t<0)))}),oo=_e(B(be)),Ee=e=>Object.assign(oe(e),{between:(t,r)=>Ee(W(e,((s,i)=>B(n=>Te(n)&&s<=n&&i>=n))(t,r))),lt:t=>Ee(W(e,(r=>B(s=>Te(s)&&s<r))(t))),gt:t=>Ee(W(e,(r=>B(s=>Te(s)&&s>r))(t))),lte:t=>Ee(W(e,(r=>B(s=>Te(s)&&s<=r))(t))),gte:t=>Ee(W(e,(r=>B(s=>Te(s)&&s>=r))(t))),positive:()=>Ee(W(e,B(t=>Te(t)&&t>0))),negative:()=>Ee(W(e,B(t=>Te(t)&&t<0)))}),ao=Ee(B(Te)),lo=oe(B(function(e){return typeof e=="boolean"})),co=oe(B(function(e){return typeof e=="symbol"})),uo=oe(B(function(e){return e==null})),fo=oe(B(function(e){return e!=null}));var Vr={__proto__:null,matcher:fe,optional:pr,array:function(...e){return Gt({[fe]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};if(e.length===0)return{matched:!0};const r=e[0];let s={};if(t.length===0)return he(r).forEach(n=>{s[n]=[]}),{matched:!0,selections:s};const i=(n,a)=>{s[n]=(s[n]||[]).concat([a])};return{matched:t.every(n=>ne(r,n,i)),selections:s}},getSelectionKeys:()=>e.length===0?[]:he(e[0])})})},set:function(...e){return oe({[fe]:()=>({match:t=>{if(!(t instanceof Set))return{matched:!1};let r={};if(t.size===0)return{matched:!0,selections:r};if(e.length===0)return{matched:!0};const s=(n,a)=>{r[n]=(r[n]||[]).concat([a])},i=e[0];return{matched:ro(t,n=>ne(i,n,s)),selections:r}},getSelectionKeys:()=>e.length===0?[]:he(e[0])})})},map:function(...e){return oe({[fe]:()=>({match:t=>{if(!(t instanceof Map))return{matched:!1};let r={};if(t.size===0)return{matched:!0,selections:r};const s=(c,u)=>{r[c]=(r[c]||[]).concat([u])};if(e.length===0)return{matched:!0};var i;if(e.length===1)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${(i=e[0])==null?void 0:i.toString()}`);const[n,a]=e;return{matched:so(t,(c,u)=>{const m=ne(n,u,s),f=ne(a,c,s);return m&&f}),selections:r}},getSelectionKeys:()=>e.length===0?[]:[...he(e[0]),...he(e[1])]})})},intersection:W,union:Ls,not:function(e){return oe({[fe]:()=>({match:t=>({matched:!ne(e,t,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})})},when:B,select:ot,any:Ns,_:io,string:no,number:oo,bigint:ao,boolean:lo,symbol:co,nullish:uo,nonNullable:fo,instanceOf:function(e){return oe(B(function(t){return r=>r instanceof t}(e)))},shape:function(e){return oe(B(to(e)))}};class ho extends Error{constructor(t){let r;try{r=JSON.stringify(t)}catch{r=t}super(`Pattern matching error: no pattern matches value ${r}`),this.input=void 0,this.input=t}}const Jt={matched:!1,value:void 0};function De(e){return new Ct(e,Jt)}class Ct{constructor(t,r){this.input=void 0,this.state=void 0,this.input=t,this.state=r}with(...t){if(this.state.matched)return this;const r=t[t.length-1],s=[t[0]];let i;t.length===3&&typeof t[1]=="function"?i=t[1]:t.length>2&&s.push(...t.slice(1,t.length-1));let n=!1,a={};const c=(m,f)=>{n=!0,a[m]=f},u=!s.some(m=>ne(m,this.input,c))||i&&!i(this.input)?Jt:{matched:!0,value:r(n?wt in a?a[wt]:a:this.input,this.input)};return new Ct(this.input,u)}when(t,r){if(this.state.matched)return this;const s=!!t(this.input);return new Ct(this.input,s?{matched:!0,value:r(this.input,this.input)}:Jt)}otherwise(t){return this.state.matched?this.state.value:t(this.input)}exhaustive(){if(this.state.matched)return this.state.value;throw new ho(this.input)}run(){return this.exhaustive()}returnType(){return this}}const go={direction:"Buy",type:"Market",triggerPrice:void 0,price:void 0,quantity:void 0},mo=({symbol:e})=>{const[t,r]=v.useState(!1),{register:s,handleSubmit:i,watch:n,control:a}=Lt({defaultValues:go}),c=lt(),[{wallet:u}]=ci(),{availableWithdraw:m}=ei(),{onSubmit:f,helper:h,maxQty:x,estLeverage:_,estLiqPrice:P}=tr({symbol:e,side:De(n("direction","Buy")).with("Buy",()=>xe.BUY).with("Sell",()=>xe.SELL).exhaustive(),order_type:De(n("type","Market")).with("Market",()=>pe.MARKET).with("Limit",()=>pe.LIMIT).with("StopLimit",()=>pe.STOP_LIMIT).exhaustive(),order_quantity:n("quantity",void 0),order_price:n("price",void 0)},{watchOrderbook:!0}),[A,j]=ct();if(c.isNil)return o.jsx(ie,{});const I=async L=>{r(!0);const{update:C}=j({eventCode:"createOrder",type:"pending",message:"Creating order..."});try{await f(As(L,e)),C({eventCode:"createOrderSuccess",type:"success",message:"Order successfully created!",autoDismiss:5e3})}catch(N){console.error('Unhandled error in "submitForm":',N),C({eventCode:"createOrderError",type:"error",message:"Order creation failed!",autoDismiss:5e3})}finally{r(!1)}},O=c[e](),[E,k,D]=e.split("_"),[z,V]=Ot(O),M=new Intl.NumberFormat("en-US",{maximumFractionDigits:z});return o.jsxs("form",{className:"flex flex-1 flex-col gap-6 min-w-[16rem] max-w-[24rem]",onSubmit:i(I),children:[o.jsxs("div",{className:"flex flex-1",children:[o.jsxs("label",{className:`flex flex-items-center flex-justify-center py-1 bg-[var(--color-bg-green)] hover:bg-[var(--color-bg-green-hover)] font-bold border-rd-l-1 border-rd-r-0 w-[50%] ${n("direction")==="Buy"?"border-solid border-3 border-[var(--color-light-green)]":""}`,children:[o.jsx("input",{type:"radio",className:"hidden",...s("direction"),value:"Buy"}),"Long"]}),o.jsxs("label",{className:`flex flex-items-center flex-justify-center py-1 bg-[var(--color-bg-red)] hover:bg-[var(--color-bg-red-hover)] font-bold border-rd-r-1 border-rd-l-0 w-[50%] ${n("direction")==="Sell"?"border-solid border-3 border-[var(--color-light-red)]":""}`,children:[o.jsx("input",{type:"radio",className:"hidden",...s("direction"),value:"Sell"}),"Short"]})]}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Available:"}),o.jsxs("span",{children:[X.format(m)," ",D]})]}),o.jsxs("select",{...s("type"),className:"flex flex-1 py-2 text-center font-bold",children:[o.jsx("option",{value:"Market",children:"Market"}),o.jsx("option",{value:"Limit",children:"Limit"}),o.jsx("option",{value:"StopLimit",children:"Stop Limit"})]}),o.jsxs("label",{className:`flex-col ${De(n("type","Market")).with("StopLimit",()=>"flex").otherwise(()=>"hidden")}`,children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Trigger Price (",D,")"]}),o.jsx(ke,{name:"triggerPrice",control:a,defaultValue:void 0,rules:{validate:{custom:async(L,C)=>{const N=await Vt(C,e,h.validator);return(N==null?void 0:N.trigger_price)!=null?N.trigger_price.message:!0}}},render:({field:{name:L,onBlur:C,onChange:N},fieldState:{error:w}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${w!=null?"border-[var(--color-red)]":""}`,decimals:V,placeholder:"Price",name:L,onBlur:C,onChange:N,hasError:w!=null}),je(w)]})})]}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Price (",D,")"]}),o.jsx(ke,{name:"price",control:a,defaultValue:void 0,rules:{validate:{custom:async(L,C)=>{const N=await Vt(C,e,h.validator);return(N==null?void 0:N.order_price)!=null?N.order_price.message:!0}}},render:({field:{name:L,onBlur:C,onChange:N},fieldState:{error:w}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${w!=null?"border-[var(--color-red)]":""}`,decimals:V,placeholder:"Price",name:L,onBlur:C,onChange:N,hasError:w!=null}),je(w)]})})]}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Quantity (",k,")"]}),o.jsx(ke,{name:"quantity",control:a,defaultValue:void 0,rules:{validate:{custom:async(L,C)=>{const N=await Vt(C,e,h.validator);return(N==null?void 0:N.order_quantity)!=null?N.order_quantity.message:!0}}},render:({field:{name:L,onBlur:C,onChange:N},fieldState:{error:w}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${w!=null?"border-[var(--color-red)]":""}`,decimals:z,placeholder:"Quantity",name:L,onBlur:C,onChange:N,hasError:w!=null}),je(w),o.jsxs("div",{className:"flex flex-1 justify-between gap-3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Max:"}),o.jsxs("span",{children:[M.format(x)," ",k]})]})]})})]}),o.jsx(Bt,{className:"min-w-full my--2"}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Est. Liq. price:"}),o.jsx("span",{children:P?`${X.format(P)} ${D}`:"-"})]}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Account leverage:"}),o.jsx("span",{children:_!=null?`⇒ ${M.format(_)}`:"-"})]}),o.jsx(Bt,{className:"min-w-full my--2"}),o.jsxs("button",{type:"submit",disabled:t,className:`relative py-2 font-size-5 bg-[var(--accent-9)] hover:bg-[var(--accent-10)] border-rd-1 border-0 ${u==null?"hidden":""}`,children:[t&&o.jsx(ie,{overlay:!0})," Create Order"]}),u==null&&o.jsx(ui,{})]})};async function Vt(e,t,r){return r(As(e,t))}function As(e,t){return{symbol:t,side:De(e.direction).with("Buy",()=>xe.BUY).with("Sell",()=>xe.SELL).exhaustive(),order_type:De(e.type).with("Market",()=>pe.MARKET).with("Limit",()=>pe.LIMIT).with("StopLimit",()=>pe.STOP_LIMIT).exhaustive(),order_price:e.price,order_quantity:e.quantity,trigger_price:e.triggerPrice}}const po=({symbol:e})=>{var u,m;const[t,{isLoading:r}]=ti(e,void 0,{level:10}),[s,i,n]=e.split("_");if(r)return o.jsx("div",{className:"w-[20rem] h-full flex-self-center flex flex-justify-center",children:o.jsx(ie,{size:"4rem"})});let a,c;return o.jsxs("div",{className:"grid gap-x-2 grid-cols-[5.5rem_5.5rem_8rem] font-bold font-size-[0.9rem] [&>*]:border-b [&>*]:border-[rgba(0, 0, 0, 0.2)] [&>*]:border-b-solid",children:[o.jsxs("div",{children:["Price (",n,")"]}),o.jsxs("div",{children:["Quantity (",i,")"]}),o.jsxs("div",{className:"text-end",children:["Total (",i,")"]}),(u=t.asks)==null?void 0:u.filter(([f])=>!Number.isNaN(f)).map(([f,h,x],_)=>{a==null&&(a=x);const P=100*x/a;return o.jsxs("div",{className:"contents [&>*:nth-child(3n)]:text-end [&>*]:border-[rgba(255,255,255,0.5)] [&>*]:border-solid [&>*]:border-0 [&>*]:border-b-1",children:[o.jsx("div",{className:"color-[var(--color-light-red)]",children:X.format(f)}),o.jsx("div",{children:h}),o.jsx("div",{style:{background:`linear-gradient(to left, rgba(161, 6, 6, 0.3) ${P}%, transparent ${P}%)`},children:x})]},_)}),(m=t.bids)==null?void 0:m.filter(([f])=>!Number.isNaN(f)).reverse().map(([f,h,x],_)=>{c==null&&(c=x);const P=100*x/c;return o.jsxs("div",{className:"contents [&>*:nth-child(3n)]:text-end [&>*]:border-[rgba(255,255,255,0.5)] [&>*]:border-solid [&>*]:border-0 [&>*]:border-b-1",children:[o.jsx("div",{className:"color-[var(--color-light-green)]",children:X.format(f)}),o.jsx("div",{children:h}),o.jsx("div",{style:{background:`linear-gradient(to left, rgba(4, 109, 4, 0.3) ${P}%, transparent ${P}%)`},children:x})]},_)}).reverse()]})},yo=({symbol:e})=>o.jsxs(Ur,{defaultValue:"positions",className:"flex-1",children:[o.jsxs(Kr,{children:[o.jsx(tt,{value:"positions",children:"Positions"}),o.jsx(tt,{value:"pending",children:"Pending"})]}),o.jsx(rt,{value:"positions",children:o.jsx(vo,{symbol:e})}),o.jsx(rt,{value:"pending",children:o.jsx(_o,{symbol:e})})]}),bo=({order:e,symbol:t,cancelOrder:r,cancelAlgoOrder:s})=>{const[i,n]=v.useState(!1),[a,c]=v.useState(!1),[u,m]=ct(),[f,h,x]=e.order.symbol.split("_");return o.jsxs(yt,{className:"[&>*]:align-mid",children:[o.jsxs(ue,{children:[h," / ",x]}),o.jsxs(ue,{children:[e.isAlgoOrder?e.order.algo_type:""," ",e.order.type]}),o.jsx(ue,{children:e.order.side}),o.jsx(ue,{children:or.format(e.order.quantity)}),o.jsx(ue,{children:e.order.price?X.format(e.order.price):"-"}),o.jsx(ue,{children:e.order.trigger_price?X.format(e.order.trigger_price):"-"}),o.jsx(ue,{children:o.jsxs(rr,{open:a,onOpenChange:c,children:[o.jsx(sr,{children:o.jsxs(ze,{className:"relative",disabled:i,children:[i&&o.jsx(ie,{overlay:!0})," Cancel"]})}),o.jsxs(ir,{className:"max-w-md",size:"1",children:[o.jsx(nr,{className:"flex justify-between flex-items-center",children:o.jsx("span",{className:"mr-2",children:"Cancel Order"})}),o.jsxs("div",{className:"w-full pt-4 flex flex-col gap-2",children:[o.jsx("span",{children:"Are you really sure, that you want to cancel this order?"}),o.jsxs("div",{className:"flex gap-4 justify-end",children:[o.jsxs(ze,{className:"relative bg-[var(--color-bg-red)]",disabled:i,onClick:()=>{c(!1)},children:[i&&o.jsx(ie,{overlay:!0})," No"]}),o.jsxs(ze,{className:"relative bg-[var(--color-bg-green)]",disabled:i,onClick:async()=>{n(!0);const{update:_}=m({eventCode:"cancelOrder",type:"pending",message:"Cancelling order..."});try{e.isAlgoOrder?await s(e.order.algo_order_id,t):await r(e.order.order_id,t),_({eventCode:"cancelOrderSuccess",type:"success",message:"Successfully cancelled order!",autoDismiss:5e3})}catch(P){console.error(P),_({eventCode:"cancelOrderError",type:"error",message:"Cancelling order failed!",autoDismiss:5e3})}finally{n(!1)}},children:[i&&o.jsx(ie,{overlay:!0})," Yes"]})]})]})]})]})})]},e.isAlgoOrder?e.order.algo_order_id:e.order.order_id)},_o=({symbol:e})=>{const[t,{cancelOrder:r,cancelAlgoOrder:s,isLoading:i}]=kt({symbol:e,status:Ke.INCOMPLETE}),n=t,{state:a}=Zt();if(!(a.status<=er.NotSignedIn))return!n||i?o.jsx(ie,{size:"2rem",className:"m-3"}):o.jsxs(zr,{children:[o.jsx(Qr,{children:o.jsxs(yt,{children:[o.jsx(de,{children:"Symbol"}),o.jsx(de,{children:"Type"}),o.jsx(de,{children:"Side"}),o.jsx(de,{children:"Quantity"}),o.jsx(de,{children:"Price"}),o.jsx(de,{children:"Trigger Price"}),o.jsx(de,{})]})}),o.jsx(Wr,{children:n.map(c=>{let u;return c.algo_order_id?u={isAlgoOrder:!0,order:c}:u={isAlgoOrder:!1,order:c},o.jsx(bo,{order:u,symbol:e,cancelOrder:r,cancelAlgoOrder:s},u.isAlgoOrder?u.order.algo_order_id:u.order.order_id)})})]})},vo=({symbol:e})=>{const[t,r,{refresh:s,loading:i}]=$r(e),{state:n}=Zt();if(!(n.status<=er.NotSignedIn))return!t.rows||i?o.jsx(ie,{size:"2rem",className:"m-3"}):o.jsxs(zr,{children:[o.jsx(Qr,{children:o.jsxs(yt,{className:"[&>*]:align-mid",children:[o.jsx(de,{children:"Symbol"}),o.jsx(de,{children:"Quantity"}),o.jsx(de,{children:"Avg. Open"}),o.jsx(de,{children:"Mark Price"}),o.jsx(de,{children:"Unreal. PnL"}),o.jsx(de,{children:"Est. Liq Price"}),o.jsx(de,{})]})}),o.jsx(Wr,{children:t.rows.map(a=>{const[c,u,m]=a.symbol.split("_");return o.jsxs(yt,{className:"[&>*]:align-mid",children:[o.jsxs(ue,{children:[u," / ",m]}),o.jsx(ue,{children:or.format(a.position_qty)}),o.jsx(ue,{children:X.format(a.average_open_price)}),o.jsx(ue,{children:X.format(a.mark_price)}),o.jsxs(ue,{children:[X.format(a.unrealized_pnl)," (",X.format(a.unrealized_pnl_ROI*100),"%)"]}),o.jsx(ue,{children:a.est_liq_price?X.format(a.est_liq_price):"-"}),o.jsx(ue,{children:o.jsx(jo,{symbol:e,position:a,refresh:s})})]},a.symbol)})})]})},xo=({symbol:e,position:t,refresh:r,setOpen:s})=>{const[i,n]=v.useState(!1),a=lt(),{register:c,handleSubmit:u,control:m,watch:f}=Lt({defaultValues:{direction:"TakeProfit",type:pe.STOP_MARKET,trigger_price:void 0,quantity:String(Math.abs(t.position_qty))}}),{onSubmit:h,helper:x}=tr({symbol:e,side:xe.BUY,order_type:pe.STOP_MARKET},{watchOrderbook:!0}),[_,P]=ct();if(a.isNil)return o.jsx(ie,{});const A=async V=>{n(!0);const{update:M}=P({eventCode:"createStopOrder",type:"pending",message:"Creating order..."});try{console.log("getInput(data, position)",Xt(V,t)),await h(Xt(V,t)),M({eventCode:"createStopOrderSuccess",type:"success",message:"Order successfully created!",autoDismiss:5e3})}catch(L){console.error('Unhandled error in "submitForm":',L),M({eventCode:"createStopOrderError",type:"error",message:"Order creation failed!",autoDismiss:5e3})}finally{n(!1),r(),s(!1)}},j=ri.unrealizedPnL({qty:Number(f("quantity")??0),openPrice:t.average_open_price,markPrice:Number(f("trigger_price")??0)}),I=a[e](),[O,E,k]=e.split("_"),[D,z]=Ot(I);return o.jsxs("form",{className:"flex flex-1 flex-col gap-3 w-full",onSubmit:u(A),children:[o.jsx("div",{children:"Create an algorithmic order to (partially) close a position when a specific mark price is reached."}),o.jsxs("div",{className:"flex flex-1",children:[o.jsxs("label",{className:`flex flex-items-center flex-justify-center py-1 bg-[var(--color-bg-green)] hover:bg-[var(--color-bg-green-hover)] font-bold border-rd-l-1 border-rd-r-0 w-[50%] ${f("direction")==="TakeProfit"?"border-solid border-3 border-[var(--color-light-green)]":""}`,children:[o.jsx("input",{type:"radio",className:"hidden",...c("direction"),value:"TakeProfit"}),"Take Profit"]}),o.jsxs("label",{className:`flex flex-items-center flex-justify-center py-1 bg-[var(--color-bg-red)] hover:bg-[var(--color-bg-red-hover)] font-bold border-rd-r-1 border-rd-l-0 w-[50%] ${f("direction")==="StopLoss"?"border-solid border-3 border-[var(--color-light-red)]":""}`,children:[o.jsx("input",{type:"radio",className:"hidden",...c("direction"),value:"StopLoss"}),"Stop Loss"]})]}),o.jsx("input",{className:"hidden",...c("type")}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Price (",k,")"]}),o.jsx(ke,{name:"trigger_price",control:m,rules:{validate:{min:(V,M)=>{const L=t.position_qty>0;if(M.trigger_price==null)return!0;const C=Number(M.trigger_price);return De([L,M.direction]).with(Vr.union([!0,"TakeProfit"],[!1,"StopLoss"]),()=>C>t.mark_price?!0:"Minimum trigger price should be greater than mark price").otherwise(()=>!0)},max:(V,M)=>{const L=t.position_qty>0;if(M.trigger_price==null)return!0;const C=Number(M.trigger_price);return De([L,M.direction]).with(Vr.union([!1,"TakeProfit"],[!0,"StopLoss"]),()=>C<t.mark_price?!0:"Maximum trigger price should be less than mark price").otherwise(()=>!0)},custom:async(V,M)=>{const L=await Br(M,t,x.validator);return(L==null?void 0:L.trigger_price)!=null?L.trigger_price.message:!0}}},render:({field:{name:V,onBlur:M,onChange:L},fieldState:{error:C}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${C!=null?"border-[var(--color-red)]":""}`,decimals:z,placeholder:"Price",name:V,onBlur:M,onChange:L,hasError:C!=null}),je(C)]})})]}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Quantity (",E,")"]}),o.jsx(ke,{name:"quantity",control:m,rules:{validate:{custom:async(V,M)=>{const L=await Br(M,t,x.validator);return(L==null?void 0:L.order_quantity)!=null?L.order_quantity.message:!0}}},render:({field:{name:V,onBlur:M,onChange:L,value:C},fieldState:{error:N}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`mb-2 ${N!=null?"border-[var(--color-red)]":""}`,decimals:D,placeholder:"Quantity",name:V,onBlur:M,onChange:L,value:C,onValueChange:w=>{C=w.toString()},min:Qe.fromString("0"),max:Qe.fromString(String(Math.abs(t.position_qty))),hasError:N!=null}),o.jsx(Tt,{value:[Number(C)],defaultValue:[100],variant:"surface",name:V,onValueChange:w=>{L(w[0])},onValueCommit:M,min:0,max:Math.abs(t.position_qty),step:I.base_tick}),o.jsxs("div",{className:"font-size-[1.1rem] flex w-full justify-center my-1",children:[C," ",E]}),je(N)]})})]}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Est. PnL:"}),o.jsx("span",{children:f("quantity")&&f("trigger_price")?`${X.format(j)} ${k}`:"-"})]}),o.jsxs("button",{type:"submit",disabled:i,className:"relative py-2 font-size-5 bg-[var(--accent-9)] hover:bg-[var(--accent-10)] border-rd-1 border-0",children:[i&&o.jsx(ie,{overlay:!0})," ",De(f("direction")).with("TakeProfit",()=>"Take Profit").with("StopLoss",()=>"Stop Loss").exhaustive()]})]})};async function Br(e,t,r){return r(Xt(e,t))}function Xt(e,t){const r=t.position_qty>0;return{symbol:t.symbol,isStopOrder:!0,order_quantity:e.quantity,trigger_price:e.trigger_price,side:r?xe.SELL:xe.BUY,order_type:pe.STOP_MARKET}}const So=({symbol:e,setSymbol:t})=>{const r=si(e);let s;if(!r)s=o.jsx(ie,{});else{let i,n;r["24h_change"]!=null&&r.index_price!=null&&(i=String(r["24h_change"].toNumber()),n=r["24h_change"].div(r.index_price).mul(100).toPrecision(4,2)),s=o.jsxs(o.Fragment,{children:[o.jsx(wo,{symbol:e,setSymbol:t}),o.jsxs("div",{className:"flex flex-col font-size-[0.9rem]",children:[o.jsx("div",{className:"font-size-[0.8rem] color-gray",children:"Mark (USD)"}),o.jsx("div",{children:X.format(r.mark_price)})]}),o.jsxs("div",{className:"flex flex-col font-size-[0.9rem]",children:[o.jsx("div",{className:"font-size-[0.8rem] color-gray",children:"Index (USD)"}),o.jsx("div",{children:X.format(r.index_price)})]}),o.jsxs("div",{className:"flex flex-col font-size-[0.9rem]",children:[o.jsx("div",{className:"font-size-[0.8rem] color-gray",children:"24h volume (USD)"}),o.jsx("div",{children:X.format(r["24h_amount"])})]}),o.jsxs("div",{className:"flex flex-col font-size-[0.9rem]",children:[o.jsx("div",{className:"font-size-[0.8rem] color-gray",children:"24h change (USD)"}),o.jsx("div",{children:i&&n?o.jsxs(o.Fragment,{children:[i.startsWith("-")?"":"+",X.format(Number(i))," /"," ",i.startsWith("-")?"":"+",n,"%"]}):"-"})]})]})}return o.jsx("div",{className:"min-h-[2.7rem] flex flex-items-center [&>*]:border-0 [&>*:not(:last-child)]:border-r-2 [&>*]:border-solid [&>*]:px-3 [&>*]:border-gray font-bold [&>*:not(:first-child)]:flex-1",children:s})},wo=({symbol:e,setSymbol:t})=>{const[r,s]=v.useState(!1),[i]=ii(ni.ALL);if(!e)return o.jsx(ie,{});const[n,a]=e.split("_");return o.jsxs(rr,{open:r,onOpenChange:s,children:[o.jsx(sr,{children:o.jsxs("button",{className:"py-3 font-size-4 bg-transparent hover:bg-[var(--accent-3)] cursor-pointer flex flex-items-center gap-2",children:["PERP-",a,o.jsx(oi,{})]})}),o.jsxs(ir,{className:"max-w-xs",size:"2",children:[o.jsx(nr,{children:o.jsx("span",{className:"mr-2",children:"Select Symbol"})}),o.jsx("div",{className:"flex flex-col max-h-[30rem]",children:Object.values(i).map(c=>{const[u,m]=c.symbol.split("_");return o.jsxs(ze,{variant:"ghost",className:"border-rd-0 py-3 font-size-4",onClick:()=>{t(c.symbol),s(!1)},children:["PERP-",m]},c.symbol)})})]})]})},Co=({symbol:e,position:t,refresh:r,setOpen:s})=>{const[i,n]=v.useState(!1),a=lt(),{handleSubmit:c,control:u,watch:m}=Lt({defaultValues:{tp_trigger_price:void 0,sl_trigger_price:void 0,quantity:String(Math.abs(t.position_qty))}}),[f,{setValue:h,submit:x,errors:_}]=ai(t),[P,A]=ct(),j=m("tp_trigger_price");v.useEffect(()=>{j!=null&&h("tp_trigger_price",j)},[j]);const I=m("sl_trigger_price");v.useEffect(()=>{I!=null&&h("sl_trigger_price",I)},[I]);const O=m("quantity");if(v.useEffect(()=>{O!=null&&h("quantity",O)},[O]),a.isNil)return o.jsx(ie,{});const E=async()=>{n(!0);const{update:C}=A({eventCode:"createStopOrder",type:"pending",message:"Creating order..."});try{await x(),C({eventCode:"createStopOrderSuccess",type:"success",message:"Order successfully created!",autoDismiss:5e3})}catch(N){console.error('Unhandled error in "submitForm":',N),C({eventCode:"createStopOrderError",type:"error",message:"Order creation failed!",autoDismiss:5e3})}finally{n(!1),r(),s(!1)}},k=a[e](),[D,z,V]=e.split("_"),[M,L]=Ot(k);return o.jsxs("form",{className:"flex flex-1 flex-col gap-3 w-full",onSubmit:c(E),children:[o.jsx("div",{children:"Create an algorithmic order to (partially) close a position when a specific mark price is reached."}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["TP Trigger Price (",V,")"]}),o.jsx(ke,{name:"tp_trigger_price",control:u,render:({field:{name:C,onBlur:N,onChange:w}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${(_==null?void 0:_.tp_trigger_price)!=null?"border-[var(--color-red)]":""}`,decimals:L,placeholder:"Price",name:C,onBlur:N,onChange:w,hasError:(_==null?void 0:_.tp_trigger_price)!=null}),je(_==null?void 0:_.tp_trigger_price)]})})]}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3 mt--3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Est. PnL:"}),o.jsx("span",{children:f.tp_pnl!=null?`${X.format(f.tp_pnl)} ${V}`:"-"})]}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["SL Trigger Price (",V,")"]}),o.jsx(ke,{name:"sl_trigger_price",control:u,render:({field:{name:C,onBlur:N,onChange:w}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`${(_==null?void 0:_.sl_trigger_price)!=null?"border-[var(--color-red)]":""}`,decimals:L,placeholder:"Price",name:C,onBlur:N,onChange:w,hasError:(_==null?void 0:_.sl_trigger_price)!=null}),je(_==null?void 0:_.sl_trigger_price)]})})]}),o.jsxs("div",{className:"flex flex-1 justify-between gap-3 mt--3",children:[o.jsx("span",{className:"font-bold color-[var(--gray-12)]",children:"Est. PnL:"}),o.jsx("span",{children:f.sl_pnl!=null?`${X.format(f.sl_pnl)} ${V}`:"-"})]}),o.jsxs("label",{className:"flex flex-col",children:[o.jsxs("span",{className:"font-bold font-size-5",children:["Quantity (",z,")"]}),o.jsx(ke,{name:"quantity",control:u,render:({field:{name:C,onBlur:N,onChange:w,value:F}})=>o.jsxs(o.Fragment,{children:[o.jsx(Ce,{className:`mb-2 ${(_==null?void 0:_.quantity)!=null?"border-[var(--color-red)]":""}`,decimals:M,placeholder:"Quantity",name:C,onBlur:N,onChange:w,value:F,onValueChange:q=>{F=q.toString()},min:Qe.fromString("0"),max:Qe.fromString(String(Math.abs(t.position_qty))),hasError:(_==null?void 0:_.quantity)!=null}),o.jsx(Tt,{value:[Number(F)],defaultValue:[100],variant:"surface",name:C,onValueChange:q=>{w(q[0])},onValueCommit:N,min:0,max:Math.abs(t.position_qty),step:k.base_tick}),o.jsxs("div",{className:"font-size-[1.1rem] flex w-full justify-center my-1",children:[F," ",z]}),je(_==null?void 0:_.quantity)]})})]}),o.jsxs("button",{type:"submit",disabled:i,className:"relative py-2 font-size-5 bg-[var(--accent-9)] hover:bg-[var(--accent-10)] border-rd-1 border-0",children:[i&&o.jsx(ie,{overlay:!0})," Create TP & SL Order"]})]})},jo=({symbol:e,position:t,refresh:r})=>{const[s,i]=v.useState(!1),n=(m,f)=>o.jsxs("div",{className:"flex flex-col gap-1",children:[o.jsx("div",{className:"font-bold font-size-[1.1rem]",children:m}),o.jsx("div",{children:f})]}),[a,c,u]=t.symbol.split("_");return o.jsxs(rr,{open:s,onOpenChange:i,children:[o.jsx(sr,{children:o.jsx(ze,{children:"Update"})}),o.jsxs(ir,{className:"max-w-md",size:"2",onInteractOutside:m=>{m.preventDefault()},children:[o.jsxs(nr,{className:"flex justify-between flex-items-center",children:[o.jsx("span",{className:"mr-2",children:"Update Position"}),o.jsx(ze,{variant:"ghost",color:"crimson",onClick:()=>{i(!1)},children:o.jsx(li,{})})]}),o.jsxs("div",{className:"flex w-full flex-wrap gap-4 pt-4 [&>*]:flex-1 [&>*]-min-w-[10rem]",children:[n("Symbol",`${c} / ${u}`),n("Quantity",or.format(t.position_qty)),n("Avg. Open",X.format(t.average_open_price)),n("Mark Price",X.format(t.mark_price)),n("Unreal. PnL",X.format(t.unrealized_pnl)),n("Est.Liq Price",t.est_liq_price?X.format(t.est_liq_price):"-")]}),o.jsx(Bt,{className:"min-w-full my-4"}),o.jsxs(Ur,{defaultValue:"close",className:"flex-1",children:[o.jsxs(Kr,{children:[o.jsx(tt,{value:"close",children:"Close Position"}),o.jsx(tt,{value:"stop",children:"Stop Market"}),o.jsx(tt,{value:"tp_sl",children:"TP / SL"})]}),o.jsx(rt,{value:"close",className:"mt-3",children:o.jsx(Zn,{symbol:e,position:t,refresh:r,setOpen:i})}),o.jsx(rt,{value:"stop",className:"mt-3",children:o.jsx(xo,{symbol:e,position:t,refresh:r,setOpen:i})}),o.jsx(rt,{value:"tp_sl",className:"mt-3",children:o.jsx(Co,{symbol:e,position:t,refresh:r,setOpen:i})})]})]})]})};function Do(){const[e,t]=v.useState();return v.useEffect(()=>{e||t("PERP_BTC_USDC")},[e,t]),e?o.jsxs("div",{className:"max-w-full w-full mt-6 flex flex-wrap flex-items-center gap-4",children:[o.jsxs("div",{className:"max-w-[54rem] w-full flex flex-col gap-1",children:[o.jsx(So,{symbol:e,setSymbol:t}),o.jsx(Dn,{symbol:e})]}),o.jsxs("div",{className:"flex flex-1 w-full flex-wrap flex-items-center flex-justify-around gap-4",children:[o.jsx(po,{symbol:e}),o.jsx(mo,{symbol:e})]}),o.jsx("div",{className:"flex flex-1 min-w-full",children:o.jsx(yo,{symbol:e})})]}):o.jsx(ie,{})}export{Do as default};
