import{r as t,j as e}from"./index-CNjFkONN.js";import{b2 as W,aZ as J,b3 as Y,b4 as Z,b5 as B,b6 as G,b7 as K,a_ as X,b8 as ee,b9 as se,ba as te,bb as M,bc as ae,bd as L,be as R,bf as re,bg as ne,bh as I,bi as oe,bj as ie,bk as le,aW as F,bl as ce,bm as de,bn as me}from"./react-icons.esm-BP2DjauK.js";import{u as V,a as q,P as A,s as z}from"./PendingButton-DGwsaRfc.js";import{m as ue,b as he,P as S,R as D,T,u as E,a as fe,c as pe,d as $,f as k,e as xe}from"./TokenInput-DjLfkqhL.js";const ge={content:{type:"ReactNode",required:!0},width:W.width,minWidth:W.minWidth,maxWidth:{...W.maxWidth,default:"360px"}},H=t.forwardRef((u,h)=>{const{children:x,className:i,open:f,defaultOpen:g,onOpenChange:r,delayDuration:v,disableHoverableContent:p,content:b,container:y,forceMount:l,...n}=J(u,ge),o={open:f,defaultOpen:g,onOpenChange:r,delayDuration:v,disableHoverableContent:p};return t.createElement(Y,{...o},t.createElement(Z,{asChild:!0},x),t.createElement(B,{container:y,forceMount:l},t.createElement(G,{asChild:!0},t.createElement(K,{sideOffset:4,collisionPadding:10,...n,asChild:!1,ref:h,className:X("rt-TooltipContent",i)},t.createElement(ee,{as:"p",className:"rt-TooltipText",size:"1"},b),t.createElement(se,{className:"rt-TooltipArrow"})))))});H.displayName="Tooltip";const ve=()=>{const[u]=V(),h=te(),[x]=M(u?"testnet":"mainnet",{filter:n=>{var o;return z.includes((o=n.network_infos)==null?void 0:o.chain_id)}}),i=ae(),[f,g]=L(),r=t.useMemo(()=>Array.isArray(x)?x[0].token_infos[0]:void 0,[x]),[{connectedChain:v}]=q(),p=R({address:r==null?void 0:r.address,decimals:r==null?void 0:r.decimals,srcToken:r==null?void 0:r.symbol,srcChainId:Number(v==null?void 0:v.id)}),{withdraw:b,unsettledPnL:y,availableWithdraw:l}=re();return e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs(ue,{children:[e.jsxs(he,{children:[e.jsxs(S,{children:[e.jsx(D,{children:"Wallet Balance:"}),e.jsxs(T,{className:"text-right",children:[E.format(Number(p.balance))," $"]})]}),e.jsxs(S,{children:[e.jsx(D,{children:"Orderly Balance:"}),e.jsxs(T,{className:"text-right",children:[E.format(h.availableBalance)," $"]})]}),e.jsxs(S,{children:[e.jsx(D,{children:"Unsettled PnL:"}),e.jsxs(T,{className:"text-right",children:[E.format(y)," $"]})]})]}),e.jsxs(S,{children:[e.jsxs(D,{className:"flex",children:[e.jsx(H,{content:"The maximum withdrawable amount. 'freeCollateral - unsettledPnL'",children:e.jsxs("div",{className:"content",children:["Withdrawable Balance ",e.jsx(ne,{})]})}),":"]}),e.jsxs(T,{className:"text-right",children:[E.format(l)," $"]})]})]}),e.jsx(je,{walletBalance:I.fromString(p.balance,{decimals:6}),orderlyBalance:I.fromString(l.toPrecision(6),{decimals:6}),withdraw:b}),e.jsx(A,{onClick:async()=>{const{update:n}=g({eventCode:"settle",type:"pending",message:"Settling PnL..."});try{await i.settle(),n({eventCode:"settleSuccess",type:"success",message:"Successfully settled PnL!",autoDismiss:5e3})}catch(o){console.error(o),n({eventCode:"settleError",type:"error",message:o.message??"Something went wrong",autoDismiss:15e3})}},children:"Settle PnL"})]})},je=({walletBalance:u,orderlyBalance:h,withdraw:x})=>{const[i,f]=t.useState(),[g,r]=t.useState(!1),[v,p]=t.useState(!0),[b,y]=t.useState(!1),[l,n]=t.useState(),[o,j]=t.useState(),[we,N]=L(),[O]=V(),{account:P}=oe(),[U]=M(O?"testnet":"mainnet",{filter:d=>{var s;return z.includes((s=d.network_infos)==null?void 0:s.chain_id)}}),[{connectedChain:c}]=q(),m=t.useMemo(()=>{var d;return Array.isArray(U)?(d=U.find(s=>s.network_infos.chain_id===Number(c==null?void 0:c.id)))==null?void 0:d.token_infos.find(s=>s.symbol==="USDC"):void 0},[U,c]),w=R({address:m==null?void 0:m.address,decimals:m==null?void 0:m.decimals,srcToken:m==null?void 0:m.symbol,srcChainId:Number(c==null?void 0:c.id)});t.useEffect(()=>{i!=null&&w.setQuantity(i.toString())},[i,w]),t.useEffect(()=>{!o||!l||o.toUnsafeFloat()<0||l.toUnsafeFloat()<0?p(!0):p(!1)},[o,l]),t.useEffect(()=>{g||(f(void 0),n(void 0),j(void 0))},[g]);const _=d=>e.jsxs("div",{className:"flex flex-col gap-6 mt-6",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Wallet balance (USDC):"}),e.jsxs("div",{className:"flex flex-items-center",children:[e.jsx("span",{className:"flex-1",children:u.toString()}),l!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"⇒"}),e.jsx("span",{className:`flex-1 text-end ${l.toUnsafeFloat()<u.toUnsafeFloat()?"color-red":"color-green"}`,children:l.toString()})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{children:"Orderly balance (USDC):"}),e.jsxs("div",{className:"flex flex-items-center",children:[e.jsx("span",{className:"flex-1",children:h.toString()}),o!=null&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"⇒"}),e.jsx("span",{className:`flex-1 text-end ${o.toUnsafeFloat()<h.toUnsafeFloat()?"color-red":"color-green"}`,children:o.toString()})]})]})]}),e.jsx(xe,{decimals:6,onValueChange:s=>{if(s.value===0n){f(void 0),n(void 0),j(void 0);return}f(s),d?(n(u.sub(s)),j(h.add(s))):(n(u.add(s)),j(h.sub(s)))}}),e.jsx(A,{disabled:v,onClick:async()=>{if(i!=null)if(d)if(Number(w.allowance)<i.toUnsafeFloat()){const{update:s}=N({eventCode:"approval",type:"pending",message:"Approving USDC for deposit..."});try{await w.approve(i.toString()),s({eventCode:"approvalSuccess",type:"success",message:"Approval complete! You can now do a deposit",autoDismiss:8e3})}catch(a){throw console.error(a),s({eventCode:"approvalError",type:"error",message:"Approval failed!",autoDismiss:5e3}),a}}else{const{update:s}=N({eventCode:"deposit",type:"pending",message:"Depositing USDC into your Orderly Account..."});try{await w.deposit(),s({eventCode:"depositSuccess",type:"success",message:"Deposit complete!",autoDismiss:5e3}),f(void 0),n(void 0),j(void 0)}catch(a){throw console.error(a),s({eventCode:"depositError",type:"error",message:"Deposit failed!",autoDismiss:5e3}),a}}else{const{update:s}=N({eventCode:"withdraw",type:"pending",message:"Withdrawing USDC from your Orderly Account..."});try{await x({chainId:Number(P.chainId),amount:i.toString(),token:"USDC",allowCrossChainWithdraw:!1}),s({eventCode:"withdrawSuccess",type:"success",message:"Withdraw complete!",autoDismiss:5e3}),f(void 0),n(void 0),j(void 0)}catch(a){throw console.error(a),s({eventCode:"withdrawError",type:"error",message:"Withdraw failed!",autoDismiss:5e3}),a}}},children:d?i!=null&&Number(w.allowance)<i.toUnsafeFloat()?"Approve":"Deposit":"Withdraw"}),O&&e.jsx(A,{disabled:b,onClick:async()=>{const{update:s}=N({eventCode:"mint",type:"pending",message:"Minting 1k USDC on testnet..."});try{const a=await fetch("https://testnet-operator-evm.orderly.org/v1/faucet/usdc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({broker_id:"orderly",chain_id:String(Number(c==null?void 0:c.id)),user_address:P.address})});if(!a.ok)throw new Error(a.status===429?"Too many requests":a.statusText);const{success:C,message:Q}=await a.json();if(!C)throw new Error(Q);s({eventCode:"mintSuccess",type:"success",message:"Mint success! It might take a while to be received in your Orderly account",autoDismiss:8e3}),y(!0)}catch(a){if(console.error(a),s){let C;a instanceof Error?C=a.message:C="Mint failed!",s({eventCode:"mintError",type:"error",message:C,autoDismiss:5e3})}throw a}},children:"Mint 1k USDC via faucet"})]});return e.jsxs(ie,{open:g,onOpenChange:r,children:[e.jsx(le,{children:e.jsx(F,{children:"Deposit / Withdraw"})}),e.jsxs(ce,{className:"max-w-xs",size:"2",onInteractOutside:d=>{d.preventDefault()},children:[e.jsxs(de,{className:"flex justify-between flex-items-center",children:[e.jsx("span",{className:"mr-2",children:"Deposit / Withdraw"}),e.jsx(F,{variant:"ghost",color:"crimson",onClick:()=>{r(!1)},children:e.jsx(me,{})})]}),e.jsxs(fe,{defaultValue:"deposit",onValueChange:()=>{j(void 0),n(void 0)},children:[e.jsxs(pe,{children:[e.jsx($,{value:"deposit",children:"Deposit"}),e.jsx($,{value:"withdraw",children:"Withdraw"})]}),e.jsx(k,{value:"deposit",children:_(!0)}),e.jsx(k,{value:"withdraw",children:_(!1)})]})]})]})};function Se(){return e.jsxs("div",{className:"max-w-full w-md",children:[e.jsx("h1",{className:"mb-8",children:"Account"}),e.jsx("div",{children:e.jsx(ve,{})})]})}export{Se as default};
